import"./CWj6FrbW.js";import"./O9NtFhcF.js";import{o as gt}from"./Bm-Peyi0.js";import{p as kt,o as f,q as p,z as W,A as mt,f as A,c as l,r as s,a as L,m as bt,s as o,x as _t,i as e,n as Y,t as H,v as He,e as k,j as ce,C as qe,F as ze,B as ve}from"./BrBLfwSL.js";import{s as E,e as j}from"./DZG3np5x.js";import{i as J,b as de}from"./kkMc64k_.js";import{r as Fe,e as fe,i as ue,m as yt,a as Ct,k as Lt,b as Ie}from"./CdTtAD6V.js";import{a as Bt,s as Oe}from"./CKH23aWu.js";import{s as St}from"./GqwecOep.js";import{i as Pt}from"./i3jxjd7U.js";import{p as xt}from"./DNC5C8Oc.js";import{z as he,D as ae}from"./CdoYSR-b.js";import{d as pe}from"./Dd92PZt0.js";import{b as Xe}from"./z60al4It.js";function je(t){return{sequences:t.sequences,sites:t.sites,branchesTested:t["branches tested"],branchesWithSelection:t["branches with selection"],pValueThreshold:t["p-value threshold"],baselineLogLikelihood:t.fits["Baseline model"]["log-likelihood"],fullModelLogLikelihood:t.fits["Full adaptive model"]["log-likelihood"],lrt:2*(t.fits["Full adaptive model"]["log-likelihood"]-t.fits["Baseline model"]["log-likelihood"]),baselineAIC:t.fits["Baseline model"].AIC,fullModelAIC:t.fits["Full adaptive model"].AIC}}function Ke(t){const r=t["test results"],i=t["branch attributes"];return Object.keys(r).map(v=>{const n=r[v],g=(i==null?void 0:i[v])||{},M=g["Rate Distributions"]||g["Rate classes"]||[];return{name:v,"Rate classes":n["Rate classes"],"Uncorrected P-value":n["Uncorrected P-value"],"Corrected P-value":n["Corrected P-value"],"Bayes Factor":n["Bayes Factor"],"ω distribution":Array.isArray(M)?M:[]}})}function Ne(t){var g;const r=(g=t["Site Log Likelihood"])==null?void 0:g.tested;if(!r)return[];const i=Object.keys(r),v=r[i[0]];if(!v||!Array.isArray(v))return[];const n=v.length;return Array.from({length:n},(M,_)=>{const T={site:_+1,partition:1};return i.forEach(oe=>{const q=r[oe];if(Array.isArray(q)&&q[_]!==void 0){const y=Array.isArray(q[_])?q[_][0]:q[_];T[oe]=typeof y=="number"?y:0}}),T})}function Ye(t,r=.05){return t.filter(i=>i["Corrected P-value"]<=r)}function Je(){return[{key:"name",label:"Branch",sortable:!0},{key:"Rate classes",label:"Rate Classes",sortable:!0},{key:"Uncorrected P-value",label:"Uncorrected p-value",sortable:!0},{key:"Corrected P-value",label:"Corrected p-value",sortable:!0},{key:"Bayes Factor",label:"Bayes Factor",sortable:!0}]}function Ge(t,r){return typeof t!="number"?String(t):r.includes("p-value")||r.includes("P-value")?t<.001?t.toExponential(2):t.toFixed(4):r==="Bayes Factor"?t.toFixed(2):r==="Rate classes"?t.toString():t.toFixed(4)}function Qe(t,r=.05){return t<=.001?"#8B0000":t<=.01?"#DC143C":t<=r?"#FF6347":"#000000"}function Ft(t,r=.05){if(!t.length)return null;const i=t.map((n,g)=>({branch:n.name,index:g,uncorrectedPValue:n["Uncorrected P-value"],correctedPValue:n["Corrected P-value"],logUncorrected:-Math.log10(Math.max(n["Uncorrected P-value"],1e-10)),logCorrected:-Math.log10(Math.max(n["Corrected P-value"],1e-10)),significant:n["Corrected P-value"]<=r})),v=-Math.log10(r);return he({title:"Branch Selection Significance",subtitle:`p-value threshold: ${r}`,width:800,height:400,marginLeft:100,marginBottom:120,x:{type:"band",domain:i.map(n=>n.branch),label:"Branch",tickRotate:-45},y:{label:"-log₁₀(p-value)",grid:!0},color:{legend:!0,range:["#1f77b4","#ff7f0e"]},marks:[ae([v],{stroke:"#d62728",strokeDasharray:"5,5",strokeWidth:2}),pe(i,{x:"branch",y:"logUncorrected",fill:"#1f77b4",r:6,title:n=>`${n.branch}
Uncorrected: ${n.uncorrectedPValue.toExponential(2)}`}),pe(i,{x:"branch",y:"logCorrected",fill:"#ff7f0e",r:6,title:n=>`${n.branch}
Corrected: ${n.correctedPValue.toExponential(2)}`}),pe(i.filter(n=>n.significant),{x:"branch",y:"logCorrected",stroke:"#d62728",strokeWidth:3,fill:"none",r:8})]})}function At(t){if(!t.length)return null;const r=t.map((i,v)=>({branch:i.name,index:v,bayesFactor:i["Bayes Factor"],logBayesFactor:Math.log10(Math.max(i["Bayes Factor"],1e-10)),evidenceLevel:Rt(i["Bayes Factor"])}));return he({title:"Bayes Factor Evidence for Selection",subtitle:"Higher values indicate stronger evidence for selection",width:800,height:400,marginLeft:100,marginBottom:120,x:{type:"band",domain:r.map(i=>i.branch),label:"Branch",tickRotate:-45},y:{label:"log₁₀(Bayes Factor)",grid:!0},color:{type:"ordinal",domain:["Very Strong","Strong","Substantial","Weak","No Evidence"],range:["#8B0000","#DC143C","#FF6347","#FFA500","#808080"]},marks:[ae([0],{stroke:"#666",strokeDasharray:"3,3"}),ae([Math.log10(3)],{stroke:"#999",strokeDasharray:"3,3"}),ae([Math.log10(10)],{stroke:"#999",strokeDasharray:"3,3"}),ae([Math.log10(100)],{stroke:"#999",strokeDasharray:"3,3"}),Xe(r,{x:"branch",y:"logBayesFactor",fill:"evidenceLevel",title:i=>`${i.branch}
Bayes Factor: ${i.bayesFactor.toFixed(2)}
Evidence: ${i.evidenceLevel}`})]})}function Mt(t){if(!t["ω distribution"]||!t["ω distribution"].length)return null;const r=t["ω distribution"].map((i,v)=>({rateClass:i["rate class"]||v+1,omega:i.omega,weight:i.weight,category:i.omega>1?"Positive Selection (ω > 1)":i.omega===1?"Neutral (ω = 1)":"Purifying Selection (ω < 1)"}));return he({title:`ω Distribution for ${t.name}`,subtitle:"Rate classes and their weights",width:600,height:300,marginLeft:80,x:{label:"Rate Class",grid:!0},y:{label:"ω (dN/dS)",grid:!0},color:{type:"ordinal",domain:["Purifying Selection (ω < 1)","Neutral (ω = 1)","Positive Selection (ω > 1)"],range:["#1f77b4","#2ca02c","#d62728"]},marks:[ae([1],{stroke:"#666",strokeDasharray:"3,3"}),pe(r,{x:"rateClass",y:"omega",fill:"category",r:i=>Math.sqrt(i.weight)*20,title:i=>`Rate Class ${i.rateClass}
ω = ${i.omega.toFixed(3)}
Weight = ${i.weight.toFixed(3)}`})]})}function Dt(t,r=[]){if(!t.length)return null;const i=Object.keys(t[0]).filter(g=>g!=="site"&&g!=="partition"),v=r.length>0?r:i.slice(0,3),n=t.flatMap(g=>v.map(M=>({site:g.site,branch:M,logLikelihood:g[M]||0})));return he({title:"Site-Level Log Likelihood",subtitle:`Showing ${v.join(", ")}`,width:1e3,height:400,marginLeft:80,x:{label:"Site",grid:!0},y:{label:"Log Likelihood",grid:!0},color:{legend:!0},marks:[Bt(n,{x:"site",y:"logLikelihood",stroke:"branch",strokeWidth:2}),pe(n.filter((g,M)=>M%10===0),{x:"site",y:"logLikelihood",fill:"branch",r:3})]})}function wt(t){const r=t.fits["Baseline model"],i=t.fits["Full adaptive model"],v=[{model:"Baseline",logLikelihood:r["log-likelihood"],AIC:r.AIC,parameters:r.parameters},{model:"Full Adaptive",logLikelihood:i["log-likelihood"],AIC:i.AIC,parameters:i.parameters}];return he({title:"Model Comparison",subtitle:"Log Likelihood and AIC values",width:500,height:300,marginLeft:100,x:{type:"band",domain:["Baseline","Full Adaptive"],label:"Model"},y:{label:"Log Likelihood",grid:!0},marks:[Xe(v,{x:"model",y:"logLikelihood",fill:"#1f77b4",title:n=>`${n.model}
Log-L: ${n.logLikelihood.toFixed(2)}
AIC: ${n.AIC.toFixed(2)}
Parameters: ${n.parameters}`})]})}function Rt(t){return t>=100?"Very Strong":t>=10?"Strong":t>=3?"Substantial":t>=1?"Weak":"No Evidence"}var Tt=A('<div class="loading svelte-i4fksl">Loading ABSREL data...</div>'),$t=A('<div class="summary-tiles svelte-i4fksl"><div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Sequences</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Sites</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Branches Tested</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Branches with Selection</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Likelihood Ratio Test</div></div></div>'),Et=A("<option> </option>"),Vt=A(`<div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">ω Distribution</h3> <p class="plot-description svelte-i4fksl">Rate classes and their weights for the selected branch. 
          Classes with ω > 1 indicate positive selection.</p> <div class="plot-container svelte-i4fksl"></div></div>`),Ut=A('<div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Site-Level Log Likelihood</h3> <p class="plot-description svelte-i4fksl">Log likelihood values across sites for selected branches.</p> <div class="plot-container svelte-i4fksl"></div></div>'),Wt=A('<span class="sort-indicator svelte-i4fksl"><!></span>'),Ht=A('<th><div class="header-content svelte-i4fksl"><span> </span> <!></div></th>'),qt=A('<td class="svelte-i4fksl"> </td>'),zt=A('<tr><td class="svelte-i4fksl"><input type="checkbox"/></td><!></tr>'),It=A("<button> </button>"),Ot=A('<div class="pagination svelte-i4fksl"><div class="pagination-info svelte-i4fksl"> </div> <div class="pagination-controls svelte-i4fksl"><button class="page-btn svelte-i4fksl">‹‹</button> <button class="page-btn svelte-i4fksl">‹</button> <!> <button class="page-btn svelte-i4fksl">›</button> <button class="page-btn svelte-i4fksl">››</button></div> <div class="page-size-control svelte-i4fksl"><label for="page-size">Per page:</label> <select id="page-size" class="svelte-i4fksl"><option>25</option><option>50</option><option>100</option></select></div></div>'),jt=A(`<div class="analysis-info svelte-i4fksl"><h2 class="svelte-i4fksl">aBSREL Analysis Results</h2> <p><strong>Adaptive Branch-Site Random Effects Likelihood</strong> test for 
        episodic positive selection. This analysis tests whether branches have 
        experienced episodic positive selection without requiring a priori 
        specification of lineages.</p></div> <!> <div class="controls svelte-i4fksl"><div class="control-group svelte-i4fksl"><label for="pvalue-threshold" class="svelte-i4fksl">p-value threshold:</label> <input type="number" id="pvalue-threshold" min="0.001" max="0.1" step="0.001" class="svelte-i4fksl"/></div> <div class="control-group svelte-i4fksl"><label class="svelte-i4fksl"><input type="checkbox"/> Show only significant branches</label></div> <div class="control-group svelte-i4fksl"><label for="omega-branch" class="svelte-i4fksl">ω distribution for branch:</label> <select id="omega-branch" class="svelte-i4fksl"><option>Select a branch...</option><!></select></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Model Comparison</h3> <p class="plot-description svelte-i4fksl">Comparison of baseline and full adaptive models based on log likelihood.</p> <div class="plot-container svelte-i4fksl"></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Branch Selection Significance</h3> <p class="plot-description svelte-i4fksl">Uncorrected and corrected p-values for each tested branch. 
        Branches below the threshold line show evidence of selection.</p> <div class="plot-container svelte-i4fksl"></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Bayes Factor Evidence</h3> <p class="plot-description svelte-i4fksl">Bayes Factor evidence for positive selection on each branch. 
        Higher values indicate stronger evidence.</p> <div class="plot-container svelte-i4fksl"></div></div> <!> <!> <div class="table-section svelte-i4fksl"><h3 class="svelte-i4fksl">Branch Test Results</h3> <p class="table-description svelte-i4fksl">Statistical test results for each branch. Click column headers to sort. 
        Select branches to view in site-level plots.</p> <div class="table-container svelte-i4fksl"><table class="svelte-i4fksl"><thead><tr><th class="svelte-i4fksl">Select</th><!></tr></thead><tbody></tbody></table></div> <!></div> <div class="citation svelte-i4fksl"><h3 class="svelte-i4fksl">Citation</h3> <code class="svelte-i4fksl">Smith MD, Wertheim JO, Weaver S, Murrell B, Scheffler K, Kosakovsky Pond SL. 
        Less is more: an adaptive branch-site random effects model for efficient 
        detection of episodic diversifying selection. Mol Biol Evol. 2015;32(5):1342-53.</code></div>`,1),Kt=A('<div class="absrel-visualization svelte-i4fksl"><!></div>');function ri(t,r){kt(r,!1);const i=p(),v=p(),n=p(),g=p(),M=p(),_=p(),T=p(),oe=p(),q=p();let y=xt(r,"data",8),re=p(.05),V=p([]),ge=p(!1),G=p(""),z=p("Corrected P-value"),Q=p("asc"),h=p(1),$=p(25),X=p(),Z=p(),ee=p(),te=p(),ie=p(),ke=p(!1);gt(()=>{f(ke,!0)});function Ze(){if(e(X)){const d=Ft(e(v),e(re));d&&(ve(X,e(X).innerHTML=""),e(X).appendChild(d))}if(e(Z)){const d=At(e(v));d&&(ve(Z,e(Z).innerHTML=""),e(Z).appendChild(d))}if(e(ee)&&e(G)){const d=e(v).find(P=>P.name===e(G));if(d){const P=Mt(d);P&&(ve(ee,e(ee).innerHTML=""),e(ee).appendChild(P))}}if(e(te)&&e(g).length>0){const d=Dt(e(g),e(V));d&&(ve(te,e(te).innerHTML=""),e(te).appendChild(d))}if(e(ie)&&y()){const d=wt(y());d&&(ve(ie,e(ie).innerHTML=""),e(ie).appendChild(d))}}function et(d){e(z)===d?f(Q,e(Q)==="asc"?"desc":"asc"):(f(z,d),f(Q,"asc")),f(h,1)}function tt(d){e(V).includes(d)?f(V,e(V).filter(P=>P!==d)):f(V,[...e(V),d])}W(()=>(ce(y()),je),()=>{f(i,y()?je(y()):null)}),W(()=>(ce(y()),Ke),()=>{f(v,y()?Ke(y()):[])}),W(()=>(e(v),Ye),()=>{f(n,e(v)?Ye(e(v)):[])}),W(()=>(ce(y()),Ne),()=>{f(g,y()?Ne(y()):[])}),W(()=>(e(ge),e(n),e(v)),()=>{f(M,e(ge)?e(n):e(v))}),W(()=>(e(M),e(z),e(Q)),()=>{f(_,[...e(M)].sort((d,P)=>{const se=d[e(z)],ne=P[e(z)],le=typeof se=="number"&&typeof ne=="number"?se-ne:String(se).localeCompare(String(ne));return e(Q)==="asc"?le:-le}))}),W(()=>(e(_),e($)),()=>{f(T,Math.ceil(e(_).length/e($)))}),W(()=>(e(_),e(h),e($)),()=>{f(oe,e(_).slice((e(h)-1)*e($),e(h)*e($)))}),W(()=>(e(ke),e(v)),()=>{e(ke)&&e(v).length>0&&Ze()}),W(()=>Je,()=>{f(q,Je())}),mt(),Pt();var me=Kt(),it=l(me);{var st=d=>{var P=Tt();L(d,P)},lt=d=>{var P=jt(),se=o(_t(P),2);{var ne=c=>{var a=$t(),u=l(a),m=l(u),C=l(m,!0);s(m),Y(2),s(u);var x=o(u,2),D=l(x),B=l(D,!0);s(D),Y(2),s(x);var S=o(x,2),F=l(S),U=l(F,!0);s(F),Y(2),s(S);var w=o(S,2),I=l(w),K=l(I,!0);s(I),Y(2),s(w);var R=o(w,2),b=l(R),N=l(b,!0);s(b),Y(2),s(R),s(a),H(O=>{E(C,(e(i),k(()=>e(i).sequences))),E(B,(e(i),k(()=>e(i).sites))),E(U,(e(i),k(()=>e(i).branchesTested))),E(K,(e(i),k(()=>e(i).branchesWithSelection))),E(N,O)},[()=>(e(i),k(()=>e(i).lrt.toFixed(2)))]),L(c,a)};J(se,c=>{e(i)&&c(ne)})}var le=o(se,2),be=l(le),Ae=o(l(be),2);Fe(Ae),s(be);var _e=o(be,2),Me=l(_e),De=l(Me);Fe(De),Y(),s(Me),s(_e);var we=o(_e,2),ye=o(l(we),2);H(()=>{e(G),He(()=>{e(v)})});var Ce=l(ye);Ce.value=Ce.__value="";var at=o(Ce);fe(at,1,()=>e(v),ue,(c,a)=>{var u=Et(),m=l(u,!0);s(u);var C={};H(()=>{E(m,(e(a),k(()=>e(a).name))),C!==(C=(e(a),k(()=>e(a).name)))&&(u.value=(u.__value=(e(a),k(()=>e(a).name)))??"")}),L(c,u)}),s(ye),s(we),s(le);var Le=o(le,2),ot=o(l(Le),4);de(ot,c=>f(ie,c),()=>e(ie)),s(Le);var Be=o(Le,2),rt=o(l(Be),4);de(rt,c=>f(X,c),()=>e(X)),s(Be);var Se=o(Be,2),nt=o(l(Se),4);de(nt,c=>f(Z,c),()=>e(Z)),s(Se);var Re=o(Se,2);{var ct=c=>{var a=Vt(),u=o(l(a),4);de(u,m=>f(ee,m),()=>e(ee)),s(a),L(c,a)};J(Re,c=>{e(G)&&c(ct)})}var Te=o(Re,2);{var vt=c=>{var a=Ut(),u=o(l(a),4);de(u,m=>f(te,m),()=>e(te)),s(a),L(c,a)};J(Te,c=>{e(V),k(()=>e(V).length>0)&&c(vt)})}var $e=o(Te,2),Pe=o(l($e),4),Ee=l(Pe),xe=l(Ee),Ve=l(xe),dt=o(l(Ve));fe(dt,1,()=>e(q),ue,(c,a)=>{var u=Ht();let m;var C=l(u),x=l(C),D=l(x,!0);s(x);var B=o(x,2);{var S=F=>{var U=Wt(),w=l(U);{var I=R=>{var b=qe();H(()=>E(b,e(Q)==="asc"?"↑":"↓")),L(R,b)},K=R=>{var b=qe("↕");L(R,b)};J(w,R=>{e(z),e(a),k(()=>e(z)===e(a).key)?R(I):R(K,!1)})}s(U),L(F,U)};J(B,F=>{e(a),k(()=>e(a).sortable)&&F(S)})}s(C),s(u),H(F=>{m=Oe(u,1,"svelte-i4fksl",null,m,F),E(D,(e(a),k(()=>e(a).label)))},[()=>({sortable:e(a).sortable,sorted:e(z)===e(a).key})]),j("click",u,()=>e(a).sortable&&et(e(a).key)),L(c,u)}),s(Ve),s(xe);var Ue=o(xe);fe(Ue,5,()=>e(oe),ue,(c,a)=>{var u=zt(),m=l(u),C=l(m);Fe(C),s(m);var x=o(m);fe(x,1,()=>e(q),ue,(D,B)=>{var S=qt(),F=l(S,!0);s(S),H((U,w)=>{St(S,`color: ${U??""}`),E(F,w)},[()=>(e(B),ce(Qe),e(a),e(re),k(()=>e(B).key.includes("p-value")||e(B).key.includes("P-value")?Qe(e(a)[e(B).key],e(re)):"inherit")),()=>(ce(Ge),e(a),e(B),k(()=>Ge(e(a)[e(B).key],e(B).key)))]),L(D,S)}),s(u),H(D=>yt(C,D),[()=>(e(V),e(a),k(()=>e(V).includes(e(a).name)))]),j("change",C,()=>tt(e(a).name)),L(c,u)}),s(Ue),s(Ee),s(Pe);var ft=o(Pe,2);{var ut=c=>{var a=Ot(),u=l(a),m=l(u);s(u);var C=o(u,2),x=l(C),D=o(x,2),B=o(D,2);fe(B,1,()=>(e(T),e(h),k(()=>Array.from({length:Math.min(5,e(T))},(b,N)=>Math.max(1,e(h)-2)+N).filter(b=>b<=e(T)))),ue,(b,N)=>{var O=It();let We;var pt=l(O,!0);s(O),H(ht=>{We=Oe(O,1,"page-btn svelte-i4fksl",null,We,ht),E(pt,e(N))},[()=>({active:e(N)===e(h)})]),j("click",O,()=>f(h,e(N))),L(b,O)});var S=o(B,2),F=o(S,2);s(C);var U=o(C,2),w=o(l(U),2);H(()=>{e($),He(()=>{e(h)})});var I=l(w);I.value=I.__value=25;var K=o(I);K.value=K.__value=50;var R=o(K);R.value=R.__value=100,s(w),s(U),s(a),H(b=>{E(m,`Showing ${(e(h)-1)*e($)+1}-${b??""} 
            of ${e(_),k(()=>e(_).length)??""} branches`),x.disabled=e(h)===1,D.disabled=e(h)===1,S.disabled=e(h)===e(T),F.disabled=e(h)===e(T)},[()=>(e(h),e($),e(_),k(()=>Math.min(e(h)*e($),e(_).length)))]),j("click",x,()=>f(h,1)),j("click",D,()=>ze(h,-1)),j("click",S,()=>ze(h)),j("click",F,()=>f(h,e(T))),Ie(w,()=>e($),b=>f($,b)),j("change",w,()=>f(h,1)),L(c,a)};J(ft,c=>{e(T)>1&&c(ut)})}s($e),Y(2),Ct(Ae,()=>e(re),c=>f(re,c)),Lt(De,()=>e(ge),c=>f(ge,c)),Ie(ye,()=>e(G),c=>f(G,c)),L(d,P)};J(it,d=>{y()?d(lt,!1):d(st)})}s(me),L(t,me),bt()}export{ri as A};
