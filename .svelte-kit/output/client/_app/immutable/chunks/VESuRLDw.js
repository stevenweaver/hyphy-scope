import{O as V,P as v,Q,R as Z,i as en,S as rn,T as _,U as q,V as on,W as sn,X as cn,Y as fn,Z as un,z as an,_ as ln,$ as G,a0 as mn,a1 as B,a2 as H,a3 as C,a4 as X,a5 as F,a6 as d,a7 as gn,a8 as hn,a9 as yn,aa as wn,ab as S}from"./BWWySPzG.js";function pn(n,t){var r=0;return Float64Array.from(n,e=>r+=+e||0)}function U(n,t,r){return(t.length!==2?V(Q(n,t,r),([e,o],[s,f])=>v(o,f)||v(e,s)):V(Z(n,r),([e,o],[s,f])=>t(o,f)||v(e,s))).map(([e])=>e)}function J(n,t=v){let r,e=!1;if(t.length===1){let o;for(const s of n){const f=t(s);(e?v(f,o)>0:v(f,f)===0)&&(r=s,o=f,e=!0)}}else for(const o of n)(e?t(o,r)>0:t(o,o)===0)&&(r=o,e=!0);return r}function jn(n={},t="y"){return rn(n)?n:{...n,[t]:en}}function vn(n,t){if(t.length===1)return{data:n,facets:t};const r=_(n),e=new Uint8Array(r);let o=0;for(const c of t)for(const u of c)e[u]&&++o,e[u]=1;if(o===0)return{data:n,facets:t};n=q(n);const s=n[on]=new Uint32Array(r+o);t=t.map(c=>q(c,Uint32Array));let f=r;e.fill(0);for(const c of t)for(let u=0,a=c.length;u<a;++u){const l=c[u];e[l]?(c[u]=f,n[f]=n[l],s[f]=l,++f):s[l]=l,e[l]=1}return{data:n,facets:t}}function xn(n={},t={}){arguments.length===1&&([n,t]=An(n));const{x1:r,x:e=r,y:o,...s}=t,[f,c,u,a]=kn(e,o,"x","y",n,s);return{...f,x1:r,x:c,y1:u,y2:a,y:un(u,a)}}function Kn({y:n,y1:t,y2:r,...e}={}){return e=sn(e,"x"),t===void 0&&r===void 0?xn({y:n,...e}):([t,r]=cn(n,t,r),{...e,y1:t,y2:r})}function An(n){const{offset:t,order:r,reverse:e,...o}=n;return[{offset:t,order:r,reverse:e},o]}const bn={length:!0};function kn(n,t=fn,r,e,{offset:o,order:s,reverse:f},c){if(t===null)throw new Error(`stack requires ${e}`);const u=an(c),[a,l]=ln(n),[i,h]=G(t),[m,y]=G(t);return i.hint=m.hint=bn,o=Xn(o),s=dn(s,o,e),[mn(c,(g,x,E)=>{({data:g,facets:x}=vn(g,x));const $=n==null?void 0:l(hn(X(g,n),E==null?void 0:E[r])),j=X(g,t,Float64Array),K=X(g,u),W=s&&s(g,$,j,K),L=_(g),A=h(new Float64Array(L)),b=y(new Float64Array(L)),M=[];for(const R of x){const D=$?Array.from(Z(R,p=>$[p]).values()):[R];if(W)for(const p of D)p.sort(W);for(const p of D){let T=0,I=0;f&&p.reverse();for(const w of p){const k=j[w];k<0?T=b[w]=(A[w]=T)+k:k>0?I=b[w]=(A[w]=I)+k:b[w]=A[w]=I}}M.push(D)}return o&&o(M,A,b,K),{data:g,facets:x}}),a,i,m]}function Xn(n){if(n!=null){if(typeof n=="function")return n;switch(`${n}`.toLowerCase()){case"expand":case"normalize":return Cn;case"center":case"silhouette":return Fn;case"wiggle":return Y}throw new Error(`unknown offset: ${n}`)}}function N(n,t){let r=0,e=0;for(const o of n){const s=t[o];s<r&&(r=s),s>e&&(e=s)}return[r,e]}function Cn(n,t,r){for(const e of n)for(const o of e){const[s,f]=N(o,r);for(const c of o){const u=1/(f-s||1);t[c]=u*(t[c]-s),r[c]=u*(r[c]-s)}}}function Fn(n,t,r){for(const e of n){for(const o of e){const[s,f]=N(o,r);for(const c of o){const u=(f+s)/2;t[c]-=u,r[c]-=u}}nn(e,t,r)}tn(n,t,r)}function Y(n,t,r,e){for(const o of n){const s=new H;let f=0;for(const c of o){let u=-1;const a=c.map(m=>Math.abs(r[m]-t[m])),l=c.map(m=>{u=e?e[m]:++u;const y=r[m]-t[m],g=s.has(u)?y-s.get(u):0;return s.set(u,y),g}),i=[0,...pn(l)];for(const m of c)t[m]+=f,r[m]+=f;const h=C(a);h&&(f-=C(a,(m,y)=>(l[y]/2+i[y])*m)/h)}nn(o,t,r)}tn(n,t,r)}function nn(n,t,r){const e=d(n,o=>d(o,s=>t[s]));for(const o of n)for(const s of o)t[s]-=e,r[s]-=e}function tn(n,t,r){const e=n.length;if(e===1)return;const o=n.map(c=>c.flat()),s=o.map(c=>(d(c,u=>t[u])+gn(c,u=>r[u]))/2),f=d(s);for(let c=0;c<e;c++){const u=f-s[c];for(const a of o[c])t[a]+=u,r[a]+=u}}function dn(n,t,r){if(n===void 0&&t===Y)return O(F);if(n!=null){if(typeof n=="string"){const e=n.startsWith("-"),o=e?yn:F;switch((e?n.slice(1):n).toLowerCase()){case"value":case r:return zn(o);case"z":return En(o);case"sum":return $n(o);case"appearance":return Dn(o);case"inside-out":return O(o)}return P(wn(n))}if(typeof n=="function")return(n.length===1?P:In)(n);if(B(n))return Sn(n);throw new Error(`invalid order: ${n}`)}}function zn(n){return(t,r,e)=>(o,s)=>n(e[o],e[s])}function En(n){return(t,r,e,o)=>(s,f)=>n(o[s],o[f])}function $n(n){return z(n,(t,r,e,o)=>U(S(t),s=>C(s,f=>e[f]),s=>o[s]))}function Dn(n){return z(n,(t,r,e,o)=>U(S(t),s=>r[J(s,f=>e[f])],s=>o[s]))}function O(n){return z(n,(t,r,e,o)=>{const s=S(t),f=U(s,i=>r[J(i,h=>e[h])],i=>o[i]),c=Q(s,i=>C(i,h=>e[h]),i=>o[i]),u=[],a=[];let l=0;for(const i of f)l<0?(l+=c.get(i),u.push(i)):(l-=c.get(i),a.push(i));return a.reverse().concat(u)})}function P(n){return t=>{const r=X(t,n);return(e,o)=>F(r[e],r[o])}}function In(n){return t=>B(t)?(r,e)=>n(t[r],t[e]):(r,e)=>n(t.get(r),t.get(e))}function Sn(n){return z(F,()=>n)}function z(n,t){return(r,e,o,s)=>{if(!s)throw new Error("missing channel: z");const f=new H(t(r,e,o,s).map((c,u)=>[c,u]));return(c,u)=>n(f.get(s[c]),f.get(s[u]))}}export{jn as a,Kn as m};
