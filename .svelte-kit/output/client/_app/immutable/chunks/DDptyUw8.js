import"./CWj6FrbW.js";import"./O9NtFhcF.js";import{o as Vt}from"./Bm-Peyi0.js";import{p as Wt,y as Ze,o as m,q as S,i as e,z as ce,j as X,A as Yt,f as _,c as r,r as a,a as c,m as qt,B as et,x as _e,s as o,t as M,e as h,v as tt,n as Qt,C as De,D as at,E as st,F as rt,w as ot}from"./BrBLfwSL.js";import{s as w,e as G}from"./DZG3np5x.js";import{i as B,b as Ut}from"./kkMc64k_.js";import{C as W,d as Ht,f as It,h as Xt,e as K,i as re,r as it,j as Gt,a as Kt,b as lt,s as Jt}from"./CdTtAD6V.js";import{m as nt,a as vt,l as bt,h as Zt}from"./BtK3TnSR.js";import{l as dt,s as fe}from"./CKH23aWu.js";import{s as ct}from"./GqwecOep.js";import{i as ea}from"./i3jxjd7U.js";import{p as we}from"./DNC5C8Oc.js";import{z as Pe,A as ut,B as pt,C as Ce,D as mt}from"./CdoYSR-b.js";import{b as Fe}from"./DVwWuO-M.js";import{d as ht}from"./Dd92PZt0.js";const L=10;function ta(f){return[{label:"Site-level dN/dS estimates",available:i=>!!i["confidence interval"]},{label:"alpha/beta site-level estimates",available:()=>!0},{label:"Bootstrap vs asymptotic p-value",available:()=>f},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>f},{label:"Dense rate plot",available:()=>!0}]}function aa(f,i){return{"Site-level dN/dS estimates":"Maximum likelihood estimates of dN/dS at each site, together with estimated profile confidence intervals (if available). dN/dS = 1 (neutrality) is depicted as a horizontal gray line. Boundaries between partitions (if present) are shown as vertical dashed lines.","alpha/beta site-level estimates":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site shown as bars. The line shows the estimates under the null model (α=β). Estimates above ${L} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site. Estimates above ${L} are censored at this value. p-values are also shown`,"Bootstrap vs asymptotic p-value":`Comparison of site-level p-values for non-neutrality using parametric bootstrap and the asymptotic approximation. Rejection region (p ≤ ${i}) is shown as a shaded rectangle`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${L} are censored at this value.`,"Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[f]||""}function sa(f){var u;const i=f.map(t=>({...t,"dN/dS MLE":Math.min(t["dN/dS MLE"]||0,L),"dN/dS LB":Math.min(t["dN/dS LB"]||0,L),"dN/dS UB":Math.min(t["dN/dS UB"]||0,L)}));return Pe({width:800,height:400,marginBottom:40,x:{label:"Codon",tickFormat:t=>t.toString()},y:{label:"dN/dS",grid:!0,type:"sqrt"},color:{type:"categorical",domain:Object.keys(W),range:Object.values(W),legend:!0},marks:[mt([1],{stroke:"gray",strokeOpacity:.5,strokeWidth:2}),...((u=f[0])==null?void 0:u["dN/dS LB"])!==void 0?[bt(i,{x:"codon",y1:"dN/dS LB",y2:"dN/dS UB",stroke:"steelblue",strokeWidth:1})]:[],ht(i,{x:"codon",y:"dN/dS MLE",fill:"class",r:4,tip:!0})]})}function ra(f){const i=f.map(t=>({codon:t.codon,alpha:-Math.min(t.alpha,L),beta:Math.min(t.beta,L),neutral:Math.min(t["alpha=beta"],L),class:t.class,partition:t.partition})),u=Math.max(...i.map(t=>Math.max(Math.abs(t.alpha),t.beta)));return Pe({width:800,height:400,marginLeft:60,marginBottom:50,x:{label:"Codon",tickFormat:t=>t.toString()},y:{label:"Rate estimate",domain:[-u*1.1,u*1.1],grid:!0,tickFormat:t=>{const T=Math.abs(t);return t>0?`β = ${T.toFixed(1)}`:t<0?`α = ${T.toFixed(1)}`:"0"}},color:{type:"categorical",domain:Object.keys(W),range:Object.values(W)},marks:[mt([0],{stroke:"gray",strokeOpacity:.5,strokeWidth:1}),Ce(i,{x:t=>t.codon-.4,x2:t=>t.codon+.4,y:0,y2:"alpha",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),Ce(i,{x:t=>t.codon-.4,x2:t=>t.codon+.4,y:0,y2:"beta",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),bt(i,{x:t=>t.codon-.4,x2:t=>t.codon+.4,y:"neutral",y2:"neutral",stroke:"#333",strokeWidth:2,strokeOpacity:.8}),Ce(i,{x:t=>t.codon-.4,x2:t=>t.codon+.4,y:"alpha",y2:"beta",fill:"transparent",title:t=>`Codon ${t.codon}
α = ${Math.abs(t.alpha).toFixed(3)}
β = ${t.beta.toFixed(3)}
α=β = ${t.neutral.toFixed(3)}
Class: ${t.class}`})]})}function oa(f,i){const u=f.map(t=>({...t,agree:(t["p-value"]-i)*((t["p-asmp"]||0)-i)>=0?"Yes":"No"}));return Pe({width:500,height:500,x:{label:"Bootstrap p-value",type:"sqrt",grid:!0},y:{label:"Asymptotic p-value",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(W),range:Object.values(W),legend:!0},marks:[Ce([{x1:0,y1:0,x2:i,y2:i}],{x1:"x1",y1:"y1",x2:"x2",y2:"y2",fill:"#DDD",fillOpacity:.3}),ht(u,{x:"p-value",y:"p-asmp",fill:"class",symbol:t=>t.agree==="Yes"?"circle":"cross",r:5,fillOpacity:.7,tip:!0})]})}function ia(f){const i=f.map(D=>Math.min(D.alpha,L)),u=f.map(D=>Math.min(D.beta,L)),t=nt(i),T=nt(u);return Pe({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},marks:[vt(i,Fe({y:"count"},{x:D=>D})),dt(i,Fe({y:"count"},{x:D=>D})),vt(u,Fe({y:"count"},{x:D=>D})),dt(u,Fe({y:"count"},{x:D=>D})),ut([t],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),ut([T],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),pt([{x:t,y:0,text:`α mean: ${t.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-10,fill:"steelblue",fontSize:12}),pt([{x:T,y:0,text:`β mean: ${T.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-25,fill:"orange",fontSize:12})]})}function la(f,i,u){switch(f){case"Site-level dN/dS estimates":return sa(i);case"alpha/beta site-level estimates":return ra(i);case"Bootstrap vs asymptotic p-value":return oa(i,u);case"Rate density plots":return ia(i);default:return null}}var na=_('<div class="loading svelte-1ud9e95"><p>Loading FEL data...</p></div>'),va=_('<div class="tile svelte-1ud9e95"><div class="tile-number svelte-1ud9e95"> </div> <div class="tile-description svelte-1ud9e95"> </div></div>'),da=_("<code> </code> site-level parametric bootstrap replicates",1),ca=_('<label class="checkbox-label svelte-1ud9e95"><input type="checkbox"/> </label>'),ua=_("<option> </option>"),pa=_('<div class="plot-section svelte-1ud9e95"><h3 class="svelte-1ud9e95">Figure 1</h3> <p class="plot-description svelte-1ud9e95"> </p> <div class="plot-container svelte-1ud9e95"></div></div>'),ba=_('<th><span class="header-content svelte-1ud9e95"> <span class="sort-indicator svelte-1ud9e95"><!></span></span></th>'),ma=_('<td class="svelte-1ud9e95"><!></td>'),ha=_("<tr></tr>"),_a=_("<button></button>"),fa=_('<span class="ellipsis svelte-1ud9e95">...</span>'),ya=_("<button> </button>"),ga=_('<span class="ellipsis svelte-1ud9e95">...</span>'),xa=_("<button>1</button> <!> <!> <!> <button> </button>",1),ka=_('<div class="pagination svelte-1ud9e95"><div class="pagination-info svelte-1ud9e95"> </div> <div class="pagination-controls svelte-1ud9e95"><button class="page-btn svelte-1ud9e95">Previous</button> <!> <button class="page-btn svelte-1ud9e95">Next</button></div> <div class="page-size-control svelte-1ud9e95"><label for="page-size" class="svelte-1ud9e95">Items per page:</label> <select id="page-size" class="svelte-1ud9e95"><option>25</option><option>50</option><option>100</option><option>200</option></select></div></div>'),Sa=_('<div class="table-container svelte-1ud9e95"><table class="svelte-1ud9e95"><thead><tr></tr></thead><tbody></tbody></table> <!></div>'),Ma=_("<p>No data to display with current filters.</p>"),Da=_(`<div class="summary-tiles svelte-1ud9e95"></div> <div class="analysis-info svelte-1ud9e95"><p>Statistical significance is evaluated based on <!>.
        This analysis <strong> </strong> site to site synonymous rate variation. <!></p></div> <div class="controls svelte-1ud9e95"><div class="control-group svelte-1ud9e95"><label for="pvalue-threshold" class="svelte-1ud9e95">p-value threshold:</label> <input id="pvalue-threshold" type="number" step="0.01" min="0" max="1" class="svelte-1ud9e95"/></div> <div class="control-group svelte-1ud9e95"><label class="svelte-1ud9e95">Show classes:</label> <div class="checkbox-group svelte-1ud9e95"></div></div> <div class="control-group svelte-1ud9e95"><label for="plot-type" class="svelte-1ud9e95">Plot type:</label> <select id="plot-type" class="svelte-1ud9e95"></select></div></div> <!> <div class="table-section svelte-1ud9e95"><h3 class="svelte-1ud9e95">Table 1</h3> <p class="table-description svelte-1ud9e95">Detailed site-by-site results from the FEL analysis</p> <!></div> <div class="citation svelte-1ud9e95"><h3 class="svelte-1ud9e95">Suggested Citation</h3> <p><code class="svelte-1ud9e95"> </code></p></div>`,1),wa=_('<div class="fel-visualization svelte-1ud9e95"><!></div>');function Ya(f,i){Wt(i,!1);const u=S(),t=S(),T=S(),D=[];let g=we(i,"data",8,null),J=we(i,"pvalueThreshold",12,.1),Y=we(i,"showColumns",28,()=>["Diversifying","Purifying","Neutral","Invariable"]),j=we(i,"plotType",12,"alpha/beta site-level estimates"),oe=S({}),k=S([[],[],{}]),y=S([]),Ae=S([]),Ve=S(""),ie=S([]),N=S(),n=S(1),P=S(50),Z=S("Site"),ee=S("asc");function _t(l){return W[l]||"#000000"}function ye(l){m(n,Math.max(1,Math.min(l,e(t))))}function ft(){e(n)<e(t)&&rt(n)}function yt(){e(n)>1&&rt(n,-1)}function gt(l){e(Z)===l?m(ee,e(ee)==="asc"?"desc":"asc"):(m(Z,l),m(ee,"asc")),m(n,1)}Vt(async()=>{await Ze(),g()&&await We()});async function We(){var x;if(!((x=g())!=null&&x.MLE))return;m(oe,Ht(g())),m(k,It(g(),J())),m(Ae,Xt(g(),J()));const l=ta(e(oe).hasPasmt);m(ie,l.filter(p=>p.available(g())).map(p=>p.label)),!e(ie).includes(j())&&e(ie).length>0&&j(e(ie)[0]),await Ze(),e(y).length===0&&e(k)[0].length>0&&Y().length>0&&m(y,e(k)[0].filter(p=>Y().includes(p.class)))}function xt(){if(!(!g()||!j()||e(y).length===0||!e(N))){m(Ve,aa(j(),J())),et(N,e(N).innerHTML="");try{const l=la(j(),e(y),J());l&&e(N).appendChild(l)}catch(l){console.error("Error creating plot:",l),et(N,e(N).innerHTML='<p class="error">Error rendering plot</p>')}}}function kt(l,x){if(typeof x=="function"){const p=x(l);return typeof p=="string"?p:String(p)}return String(l)}ce(()=>(e(k),X(Y()),e(y)),()=>{if(e(k)&&e(k)[0]&&e(k)[0].length>0&&Y()&&Y().length>0){const l=e(k)[0].filter(x=>Y().includes(x.class));(l.length!==e(y).length||!l.every((x,p)=>x===e(y)[p]))&&(m(y,l),m(n,1))}}),ce(()=>(e(y),e(Z),e(ee)),()=>{m(u,[...e(y)].sort((l,x)=>{const p=l[e(Z)],q=x[e(Z)];if(typeof p=="number"&&typeof q=="number")return e(ee)==="asc"?p-q:q-p;const te=String(p).toLowerCase(),ae=String(q).toLowerCase();return e(ee)==="asc"?te<ae?-1:te>ae?1:0:te>ae?-1:te<ae?1:0}))}),ce(()=>(e(u),e(P)),()=>{m(t,Math.ceil(e(u).length/e(P)))}),ce(()=>(e(u),e(n),e(P)),()=>{m(T,e(u).slice((e(n)-1)*e(P),e(n)*e(P)))}),ce(()=>(X(g()),X(J())),()=>{g()&&J()!==void 0&&We()}),ce(()=>(X(j()),e(y),e(N)),()=>{j()&&e(y)&&e(y).length>0&&e(N)&&xt()}),Yt(),ea();var Be=wa(),St=r(Be);{var Mt=l=>{var x=na();c(l,x)},Dt=l=>{var x=Da(),p=_e(x);K(p,5,()=>e(Ae),re,(v,s)=>{var d=va(),b=r(d),F=r(b,!0);a(b);var z=o(b,2),ue=r(z,!0);a(z),a(d),M(()=>{ct(d,`border-left: 4px solid var(--color-${e(s),h(()=>e(s).color)??""}, #ccc)`),w(F,(e(s),h(()=>e(s).number))),w(ue,(e(s),h(()=>e(s).description)))}),c(v,d)}),a(p);var q=o(p,2),te=r(q),ae=o(r(te));{var wt=v=>{var s=da(),d=_e(s),b=r(d,!0);a(d),Qt(),M(()=>w(b,(X(g()),h(()=>g().simulated)))),c(v,s)},Ft=v=>{var s=De("the asymptotic chi-squared distribution");c(v,s)};B(ae,v=>{X(g()),h(()=>g().simulated)?v(wt):v(Ft,!1)})}var Le=o(ae,2),Ct=r(Le,!0);a(Le);var Pt=o(Le,2);{var Bt=v=>{var s=De("Profile approximate confidence intervals for site-level dN/dS ratios have been computed.");c(v,s)};B(Pt,v=>{e(oe),h(()=>e(oe).hasCi)&&v(Bt)})}a(te),a(q);var Ne=o(q,2),Oe=r(Ne),Ye=o(r(Oe),2);it(Ye),a(Oe);var $e=o(Oe,2),qe=o(r($e),2);K(qe,5,()=>(X(W),h(()=>Object.keys(W))),re,(v,s)=>{var d=ca(),b=r(d);it(b);var F,z=o(b);a(d),M(ue=>{ct(d,`border-bottom: 2px solid ${ue??""}`),F!==(F=e(s))&&(b.value=(b.__value=e(s))??""),w(z,` ${e(s)??""}`)},[()=>(e(s),h(()=>_t(e(s))))]),Gt(D,[],b,()=>(e(s),Y()),Y),c(v,d)}),a(qe),a($e);var Qe=o($e,2),Ee=o(r(Qe),2);M(()=>{j(),tt(()=>{e(ie)})}),K(Ee,5,()=>e(ie),re,(v,s)=>{var d=ua(),b=r(d,!0);a(d);var F={};M(()=>{w(b,e(s)),F!==(F=e(s))&&(d.value=(d.__value=e(s))??"")}),c(v,d)}),a(Ee),a(Qe),a(Ne);var Ue=o(Ne,2);{var Lt=v=>{var s=pa(),d=o(r(s),2),b=r(d,!0);a(d);var F=o(d,2);Ut(F,z=>m(N,z),()=>e(N)),a(s),M(()=>w(b,e(Ve))),c(v,s)};B(Ue,v=>{e(y),h(()=>e(y).length>0)&&v(Lt)})}var Te=o(Ue,2),Nt=o(r(Te),4);{var Ot=v=>{var s=Sa(),d=r(s),b=r(d),F=r(b);K(F,5,()=>(e(k),h(()=>e(k)[1])),re,(R,Q)=>{var O=at(()=>st(e(Q),2));let U=()=>e(O)[0],se=()=>e(O)[1];var C=ba(),A=r(C),H=r(A),le=o(H),ge=r(le);{var xe=$=>{var I=De();M(()=>w(I,e(ee)==="asc"?"↑":"↓")),c($,I)},ne=$=>{var I=De("↕");c($,I)};B(ge,$=>{e(Z)===U()?$(xe):$(ne,!1)})}a(le),a(A),a(C),M(()=>{Jt(C,"title",se()),fe(C,1,`sortable ${e(Z)===U()?"sorted":""}`,"svelte-1ud9e95"),w(H,`${U()??""} `)}),G("click",C,()=>gt(U())),c(R,C)}),a(F),a(b);var z=o(b);K(z,5,()=>e(T),R=>R.codon,(R,Q)=>{var O=ha();K(O,5,()=>(e(k),h(()=>e(k)[1])),re,(U,se)=>{var C=at(()=>st(e(se),1));let A=()=>e(C)[0];var H=ma(),le=r(H);Zt(le,()=>(e(Q),A(),e(k),h(()=>kt(e(Q)[A()],e(k)[2][A()])))),a(H),c(U,H)}),a(O),c(R,O)}),a(z),a(d);var ue=o(d,2);{var Tt=R=>{var Q=ka(),O=r(Q),U=r(O);a(O);var se=o(O,2),C=r(se),A=o(C,2);{var H=E=>{var pe=ot(),be=_e(pe);K(be,1,()=>(e(t),h(()=>Array(e(t)).fill(0))),re,(ke,Ke,ve,ze)=>{var de=_a();de.textContent=ve+1,M(()=>fe(de,1,`page-btn ${e(n)===ve+1?"active":""}`,"svelte-1ud9e95")),G("click",de,()=>ye(ve+1)),c(ke,de)}),c(E,pe)},le=E=>{var pe=xa(),be=_e(pe),ke=o(be,2);{var Ke=V=>{var Me=fa();c(V,Me)};B(ke,V=>{e(n)>3&&V(Ke)})}var ve=o(ke,2);K(ve,0,()=>h(()=>Array(3).fill(0)),re,(V,Me,me,Fa)=>{var Je=ot(),zt=_e(Je);{var Rt=Re=>{var he=ya(),At=r(he,!0);a(he),M(()=>{fe(he,1,`page-btn ${e(n)===e(n)+me-1?"active":""}`,"svelte-1ud9e95"),w(At,e(n)+me-1)}),G("click",he,()=>ye(e(n)+me-1)),c(Re,he)};B(zt,Re=>{e(n)+me-1>1&&e(n)+me-1<e(t)&&Re(Rt)})}c(V,Je)});var ze=o(ve,2);{var de=V=>{var Me=ga();c(V,Me)};B(ze,V=>{e(n)<e(t)-2&&V(de)})}var Se=o(ze,2),jt=r(Se,!0);a(Se),M(()=>{fe(be,1,`page-btn ${e(n)===1?"active":""}`,"svelte-1ud9e95"),fe(Se,1,`page-btn ${e(n)===e(t)?"active":""}`,"svelte-1ud9e95"),w(jt,e(t))}),G("click",be,()=>ye(1)),G("click",Se,()=>ye(e(t))),c(E,pe)};B(A,E=>{e(t)<=7?E(H):E(le,!1)})}var ge=o(A,2);a(se);var xe=o(se,2),ne=o(r(xe),2);M(()=>{e(P),tt(()=>{e(n)})});var $=r(ne);$.value=$.__value=25;var I=o($);I.value=I.__value=50;var je=o(I);je.value=je.__value=100;var Ge=o(je);Ge.value=Ge.__value=200,a(ne),a(xe),a(Q),M(E=>{w(U,`Showing ${(e(n)-1)*e(P)+1}-${E??""} of ${e(u),h(()=>e(u).length)??""} results`),C.disabled=e(n)===1,ge.disabled=e(n)===e(t)},[()=>(e(n),e(P),e(u),h(()=>Math.min(e(n)*e(P),e(u).length)))]),G("click",C,yt),G("click",ge,ft),lt(ne,()=>e(P),E=>m(P,E)),G("change",ne,()=>m(n,1)),c(R,Q)};B(ue,R=>{e(t)>1&&R(Tt)})}a(s),c(v,s)},$t=v=>{var s=Ma();c(v,s)};B(Nt,v=>{e(y),h(()=>e(y).length>0)?v(Ot):v($t,!1)})}a(Te);var He=o(Te,2),Ie=o(r(He),2),Xe=r(Ie),Et=r(Xe,!0);a(Xe),a(Ie),a(He),M(()=>{w(Ct,(e(oe),h(()=>e(oe).hasBackground?"included":"does not include"))),w(Et,(X(g()),h(()=>g().analysis.citation)))}),Kt(Ye,J),lt(Ee,j),c(l,x)};B(St,l=>{g()?l(Dt,!1):l(Mt)})}a(Be),c(f,Be),qt()}export{Ya as F};
