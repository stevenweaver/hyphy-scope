import"./CWj6FrbW.js";import"./Dh1LkfYh.js";import{o as ht}from"./BVXFiTq-.js";import{p as gt,i as e,q as p,A as ce,y as W,z as kt,f as A,c as l,r as s,a as C,m as mt,s as o,x as bt,n as Y,t as H,v as He,e as k,o as f,j as ve,B as qe,E as ze}from"./CGZSrXyu.js";import{s as $,e as j}from"./BzHdtkot.js";import{i as J,b as de}from"./JwmFF-xm.js";import{r as xe,e as fe,i as ue,m as _t,a as yt,k as Lt,b as Ie}from"./BM8ST8i7.js";import{a as Ct,s as Oe}from"./BCAIgc4A.js";import{s as Bt}from"./BR0iTFIE.js";import{i as St}from"./ui6rPYHM.js";import{p as Pt}from"./BWiVFVQA.js";import{z as he,D as ae}from"./CKo-VmNz.js";import{d as pe}from"./CH6E2OhH.js";import{b as Xe}from"./VyfRdQgz.js";function je(t){return{sequences:t.sequences,sites:t.sites,branchesTested:t["branches tested"],branchesWithSelection:t["branches with selection"],pValueThreshold:t["p-value threshold"],baselineLogLikelihood:t.fits["Baseline model"]["log-likelihood"],fullModelLogLikelihood:t.fits["Full adaptive model"]["log-likelihood"],lrt:2*(t.fits["Full adaptive model"]["log-likelihood"]-t.fits["Baseline model"]["log-likelihood"]),baselineAIC:t.fits["Baseline model"].AIC,fullModelAIC:t.fits["Full adaptive model"].AIC}}function Ke(t){const r=t["test results"],i=t["branch attributes"];return Object.keys(r).map(c=>{const n=r[c],g=(i==null?void 0:i[c])||{},M=g["Rate Distributions"]||g["Rate classes"]||[];return{name:c,"Rate classes":n["Rate classes"],"Uncorrected P-value":n["Uncorrected P-value"],"Corrected P-value":n["Corrected P-value"],"Bayes Factor":n["Bayes Factor"],"ω distribution":Array.isArray(M)?M:[]}})}function Ne(t){var g;const r=(g=t["Site Log Likelihood"])==null?void 0:g.tested;if(!r)return[];const i=Object.keys(r),c=r[i[0]];if(!c||!Array.isArray(c))return[];const n=c.length;return Array.from({length:n},(M,_)=>{const E={site:_+1,partition:1};return i.forEach(oe=>{const q=r[oe];if(Array.isArray(q)&&q[_]!==void 0){const y=Array.isArray(q[_])?q[_][0]:q[_];E[oe]=typeof y=="number"?y:0}}),E})}function Ye(t,r=.05){return t.filter(i=>i["Corrected P-value"]<=r)}function Je(){return[{key:"name",label:"Branch",sortable:!0},{key:"Rate classes",label:"Rate Classes",sortable:!0},{key:"Uncorrected P-value",label:"Uncorrected p-value",sortable:!0},{key:"Corrected P-value",label:"Corrected p-value",sortable:!0},{key:"Bayes Factor",label:"Bayes Factor",sortable:!0}]}function Ge(t,r){return typeof t!="number"?String(t):r.includes("p-value")||r.includes("P-value")?t<.001?t.toExponential(2):t.toFixed(4):r==="Bayes Factor"?t.toFixed(2):r==="Rate classes"?t.toString():t.toFixed(4)}function Qe(t,r=.05){return t<=.001?"#8B0000":t<=.01?"#DC143C":t<=r?"#FF6347":"#000000"}function xt(t,r=.05){if(!t.length)return null;const i=t.map((n,g)=>({branch:n.name,index:g,uncorrectedPValue:n["Uncorrected P-value"],correctedPValue:n["Corrected P-value"],logUncorrected:-Math.log10(Math.max(n["Uncorrected P-value"],1e-10)),logCorrected:-Math.log10(Math.max(n["Corrected P-value"],1e-10)),significant:n["Corrected P-value"]<=r})),c=-Math.log10(r);return he({title:"Branch Selection Significance",subtitle:`p-value threshold: ${r}`,width:800,height:400,marginLeft:100,marginBottom:120,x:{type:"band",domain:i.map(n=>n.branch),label:"Branch",tickRotate:-45},y:{label:"-log₁₀(p-value)",grid:!0},color:{legend:!0,range:["#1f77b4","#ff7f0e"]},marks:[ae([c],{stroke:"#d62728",strokeDasharray:"5,5",strokeWidth:2}),pe(i,{x:"branch",y:"logUncorrected",fill:"#1f77b4",r:6,title:n=>`${n.branch}
Uncorrected: ${n.uncorrectedPValue.toExponential(2)}`}),pe(i,{x:"branch",y:"logCorrected",fill:"#ff7f0e",r:6,title:n=>`${n.branch}
Corrected: ${n.correctedPValue.toExponential(2)}`}),pe(i.filter(n=>n.significant),{x:"branch",y:"logCorrected",stroke:"#d62728",strokeWidth:3,fill:"none",r:8})]})}function Ft(t){if(!t.length)return null;const r=t.map((i,c)=>({branch:i.name,index:c,bayesFactor:i["Bayes Factor"],logBayesFactor:Math.log10(Math.max(i["Bayes Factor"],1e-10)),evidenceLevel:wt(i["Bayes Factor"])}));return he({title:"Bayes Factor Evidence for Selection",subtitle:"Higher values indicate stronger evidence for selection",width:800,height:400,marginLeft:100,marginBottom:120,x:{type:"band",domain:r.map(i=>i.branch),label:"Branch",tickRotate:-45},y:{label:"log₁₀(Bayes Factor)",grid:!0},color:{type:"ordinal",domain:["Very Strong","Strong","Substantial","Weak","No Evidence"],range:["#8B0000","#DC143C","#FF6347","#FFA500","#808080"]},marks:[ae([0],{stroke:"#666",strokeDasharray:"3,3"}),ae([Math.log10(3)],{stroke:"#999",strokeDasharray:"3,3"}),ae([Math.log10(10)],{stroke:"#999",strokeDasharray:"3,3"}),ae([Math.log10(100)],{stroke:"#999",strokeDasharray:"3,3"}),Xe(r,{x:"branch",y:"logBayesFactor",fill:"evidenceLevel",title:i=>`${i.branch}
Bayes Factor: ${i.bayesFactor.toFixed(2)}
Evidence: ${i.evidenceLevel}`})]})}function At(t){if(!t["ω distribution"]||!t["ω distribution"].length)return null;const r=t["ω distribution"].map((i,c)=>({rateClass:i["rate class"]||c+1,omega:i.omega,weight:i.weight,category:i.omega>1?"Positive Selection (ω > 1)":i.omega===1?"Neutral (ω = 1)":"Purifying Selection (ω < 1)"}));return he({title:`ω Distribution for ${t.name}`,subtitle:"Rate classes and their weights",width:600,height:300,marginLeft:80,x:{label:"Rate Class",grid:!0},y:{label:"ω (dN/dS)",grid:!0},color:{type:"ordinal",domain:["Purifying Selection (ω < 1)","Neutral (ω = 1)","Positive Selection (ω > 1)"],range:["#1f77b4","#2ca02c","#d62728"]},marks:[ae([1],{stroke:"#666",strokeDasharray:"3,3"}),pe(r,{x:"rateClass",y:"omega",fill:"category",r:i=>Math.sqrt(i.weight)*20,title:i=>`Rate Class ${i.rateClass}
ω = ${i.omega.toFixed(3)}
Weight = ${i.weight.toFixed(3)}`})]})}function Mt(t,r=[]){if(!t.length)return null;const i=Object.keys(t[0]).filter(g=>g!=="site"&&g!=="partition"),c=r.length>0?r:i.slice(0,3),n=t.flatMap(g=>c.map(M=>({site:g.site,branch:M,logLikelihood:g[M]||0})));return he({title:"Site-Level Log Likelihood",subtitle:`Showing ${c.join(", ")}`,width:1e3,height:400,marginLeft:80,x:{label:"Site",grid:!0},y:{label:"Log Likelihood",grid:!0},color:{legend:!0},marks:[Ct(n,{x:"site",y:"logLikelihood",stroke:"branch",strokeWidth:2}),pe(n.filter((g,M)=>M%10===0),{x:"site",y:"logLikelihood",fill:"branch",r:3})]})}function Dt(t){const r=t.fits["Baseline model"],i=t.fits["Full adaptive model"],c=[{model:"Baseline",logLikelihood:r["log-likelihood"],AIC:r.AIC,parameters:r.parameters},{model:"Full Adaptive",logLikelihood:i["log-likelihood"],AIC:i.AIC,parameters:i.parameters}];return he({title:"Model Comparison",subtitle:"Log Likelihood and AIC values",width:500,height:300,marginLeft:100,x:{type:"band",domain:["Baseline","Full Adaptive"],label:"Model"},y:{label:"Log Likelihood",grid:!0},marks:[Xe(c,{x:"model",y:"logLikelihood",fill:"#1f77b4",title:n=>`${n.model}
Log-L: ${n.logLikelihood.toFixed(2)}
AIC: ${n.AIC.toFixed(2)}
Parameters: ${n.parameters}`})]})}function wt(t){return t>=100?"Very Strong":t>=10?"Strong":t>=3?"Substantial":t>=1?"Weak":"No Evidence"}var Rt=A('<div class="loading svelte-i4fksl">Loading ABSREL data...</div>'),Et=A('<div class="summary-tiles svelte-i4fksl"><div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Sequences</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Sites</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Branches Tested</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Branches with Selection</div></div> <div class="tile svelte-i4fksl"><div class="tile-number svelte-i4fksl"> </div> <div class="tile-description svelte-i4fksl">Likelihood Ratio Test</div></div></div>'),Tt=A("<option> </option>"),$t=A(`<div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">ω Distribution</h3> <p class="plot-description svelte-i4fksl">Rate classes and their weights for the selected branch. 
          Classes with ω > 1 indicate positive selection.</p> <div class="plot-container svelte-i4fksl"></div></div>`),Vt=A('<div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Site-Level Log Likelihood</h3> <p class="plot-description svelte-i4fksl">Log likelihood values across sites for selected branches.</p> <div class="plot-container svelte-i4fksl"></div></div>'),Ut=A('<span class="sort-indicator svelte-i4fksl"><!></span>'),Wt=A('<th><div class="header-content svelte-i4fksl"><span> </span> <!></div></th>'),Ht=A('<td class="svelte-i4fksl"> </td>'),qt=A('<tr><td class="svelte-i4fksl"><input type="checkbox"/></td><!></tr>'),zt=A("<button> </button>"),It=A('<div class="pagination svelte-i4fksl"><div class="pagination-info svelte-i4fksl"> </div> <div class="pagination-controls svelte-i4fksl"><button class="page-btn svelte-i4fksl">‹‹</button> <button class="page-btn svelte-i4fksl">‹</button> <!> <button class="page-btn svelte-i4fksl">›</button> <button class="page-btn svelte-i4fksl">››</button></div> <div class="page-size-control svelte-i4fksl"><label for="page-size">Per page:</label> <select id="page-size" class="svelte-i4fksl"><option>25</option><option>50</option><option>100</option></select></div></div>'),Ot=A(`<div class="analysis-info svelte-i4fksl"><h2 class="svelte-i4fksl">aBSREL Analysis Results</h2> <p><strong>Adaptive Branch-Site Random Effects Likelihood</strong> test for 
        episodic positive selection. This analysis tests whether branches have 
        experienced episodic positive selection without requiring a priori 
        specification of lineages.</p></div> <!> <div class="controls svelte-i4fksl"><div class="control-group svelte-i4fksl"><label for="pvalue-threshold" class="svelte-i4fksl">p-value threshold:</label> <input type="number" id="pvalue-threshold" min="0.001" max="0.1" step="0.001" class="svelte-i4fksl"/></div> <div class="control-group svelte-i4fksl"><label class="svelte-i4fksl"><input type="checkbox"/> Show only significant branches</label></div> <div class="control-group svelte-i4fksl"><label for="omega-branch" class="svelte-i4fksl">ω distribution for branch:</label> <select id="omega-branch" class="svelte-i4fksl"><option>Select a branch...</option><!></select></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Model Comparison</h3> <p class="plot-description svelte-i4fksl">Comparison of baseline and full adaptive models based on log likelihood.</p> <div class="plot-container svelte-i4fksl"></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Branch Selection Significance</h3> <p class="plot-description svelte-i4fksl">Uncorrected and corrected p-values for each tested branch. 
        Branches below the threshold line show evidence of selection.</p> <div class="plot-container svelte-i4fksl"></div></div> <div class="plot-section svelte-i4fksl"><h3 class="svelte-i4fksl">Bayes Factor Evidence</h3> <p class="plot-description svelte-i4fksl">Bayes Factor evidence for positive selection on each branch. 
        Higher values indicate stronger evidence.</p> <div class="plot-container svelte-i4fksl"></div></div> <!> <!> <div class="table-section svelte-i4fksl"><h3 class="svelte-i4fksl">Branch Test Results</h3> <p class="table-description svelte-i4fksl">Statistical test results for each branch. Click column headers to sort. 
        Select branches to view in site-level plots.</p> <div class="table-container svelte-i4fksl"><table class="svelte-i4fksl"><thead><tr><th class="svelte-i4fksl">Select</th><!></tr></thead><tbody></tbody></table></div> <!></div> <div class="citation svelte-i4fksl"><h3 class="svelte-i4fksl">Citation</h3> <code class="svelte-i4fksl">Smith MD, Wertheim JO, Weaver S, Murrell B, Scheffler K, Kosakovsky Pond SL. 
        Less is more: an adaptive branch-site random effects model for efficient 
        detection of episodic diversifying selection. Mol Biol Evol. 2015;32(5):1342-53.</code></div>`,1),jt=A('<div class="absrel-visualization svelte-i4fksl"><!></div>');function oi(t,r){gt(r,!1);const i=p(),c=p(),n=p(),g=p(),M=p(),_=p(),E=p(),oe=p(),q=p();let y=Pt(r,"data",8),re=p(.05),V=p([]),ge=p(!1),G=p(""),z=p("Corrected P-value"),Q=p("asc"),h=p(1),T=p(25),X=p(),Z=p(),ee=p(),te=p(),ie=p();ht(()=>{e(c).length>0&&Fe()});function Fe(){if(e(X)){const d=xt(e(c),e(re));d&&(ce(X,e(X).innerHTML=""),e(X).appendChild(d))}if(e(Z)){const d=Ft(e(c));d&&(ce(Z,e(Z).innerHTML=""),e(Z).appendChild(d))}if(e(ee)&&e(G)){const d=e(c).find(P=>P.name===e(G));if(d){const P=At(d);P&&(ce(ee,e(ee).innerHTML=""),e(ee).appendChild(P))}}if(e(te)&&e(g).length>0){const d=Mt(e(g),e(V));d&&(ce(te,e(te).innerHTML=""),e(te).appendChild(d))}if(e(ie)&&y()){const d=Dt(y());d&&(ce(ie,e(ie).innerHTML=""),e(ie).appendChild(d))}}function Ze(d){e(z)===d?f(Q,e(Q)==="asc"?"desc":"asc"):(f(z,d),f(Q,"asc")),f(h,1)}function et(d){e(V).includes(d)?f(V,e(V).filter(P=>P!==d)):f(V,[...e(V),d])}W(()=>(ve(y()),je),()=>{f(i,y()?je(y()):null)}),W(()=>(ve(y()),Ke),()=>{f(c,y()?Ke(y()):[])}),W(()=>(e(c),Ye),()=>{f(n,e(c)?Ye(e(c)):[])}),W(()=>(ve(y()),Ne),()=>{f(g,y()?Ne(y()):[])}),W(()=>(e(ge),e(n),e(c)),()=>{f(M,e(ge)?e(n):e(c))}),W(()=>(e(M),e(z),e(Q)),()=>{f(_,[...e(M)].sort((d,P)=>{const se=d[e(z)],ne=P[e(z)],le=typeof se=="number"&&typeof ne=="number"?se-ne:String(se).localeCompare(String(ne));return e(Q)==="asc"?le:-le}))}),W(()=>(e(_),e(T)),()=>{f(E,Math.ceil(e(_).length/e(T)))}),W(()=>(e(_),e(h),e(T)),()=>{f(oe,e(_).slice((e(h)-1)*e(T),e(h)*e(T)))}),W(()=>e(c),()=>{e(c).length>0&&Fe()}),W(()=>Je,()=>{f(q,Je())}),kt(),St();var ke=jt(),tt=l(ke);{var it=d=>{var P=Rt();C(d,P)},st=d=>{var P=Ot(),se=o(bt(P),2);{var ne=v=>{var a=Et(),u=l(a),m=l(u),L=l(m,!0);s(m),Y(2),s(u);var x=o(u,2),D=l(x),B=l(D,!0);s(D),Y(2),s(x);var S=o(x,2),F=l(S),U=l(F,!0);s(F),Y(2),s(S);var w=o(S,2),I=l(w),K=l(I,!0);s(I),Y(2),s(w);var R=o(w,2),b=l(R),N=l(b,!0);s(b),Y(2),s(R),s(a),H(O=>{$(L,(e(i),k(()=>e(i).sequences))),$(B,(e(i),k(()=>e(i).sites))),$(U,(e(i),k(()=>e(i).branchesTested))),$(K,(e(i),k(()=>e(i).branchesWithSelection))),$(N,O)},[()=>(e(i),k(()=>e(i).lrt.toFixed(2)))]),C(v,a)};J(se,v=>{e(i)&&v(ne)})}var le=o(se,2),me=l(le),Ae=o(l(me),2);xe(Ae),s(me);var be=o(me,2),Me=l(be),De=l(Me);xe(De),Y(),s(Me),s(be);var we=o(be,2),_e=o(l(we),2);H(()=>{e(G),He(()=>{e(c)})});var ye=l(_e);ye.value=ye.__value="";var lt=o(ye);fe(lt,1,()=>e(c),ue,(v,a)=>{var u=Tt(),m=l(u,!0);s(u);var L={};H(()=>{$(m,(e(a),k(()=>e(a).name))),L!==(L=(e(a),k(()=>e(a).name)))&&(u.value=(u.__value=(e(a),k(()=>e(a).name)))??"")}),C(v,u)}),s(_e),s(we),s(le);var Le=o(le,2),at=o(l(Le),4);de(at,v=>f(ie,v),()=>e(ie)),s(Le);var Ce=o(Le,2),ot=o(l(Ce),4);de(ot,v=>f(X,v),()=>e(X)),s(Ce);var Be=o(Ce,2),rt=o(l(Be),4);de(rt,v=>f(Z,v),()=>e(Z)),s(Be);var Re=o(Be,2);{var nt=v=>{var a=$t(),u=o(l(a),4);de(u,m=>f(ee,m),()=>e(ee)),s(a),C(v,a)};J(Re,v=>{e(G)&&v(nt)})}var Ee=o(Re,2);{var ct=v=>{var a=Vt(),u=o(l(a),4);de(u,m=>f(te,m),()=>e(te)),s(a),C(v,a)};J(Ee,v=>{e(V),k(()=>e(V).length>0)&&v(ct)})}var Te=o(Ee,2),Se=o(l(Te),4),$e=l(Se),Pe=l($e),Ve=l(Pe),vt=o(l(Ve));fe(vt,1,()=>e(q),ue,(v,a)=>{var u=Wt();let m;var L=l(u),x=l(L),D=l(x,!0);s(x);var B=o(x,2);{var S=F=>{var U=Ut(),w=l(U);{var I=R=>{var b=qe();H(()=>$(b,e(Q)==="asc"?"↑":"↓")),C(R,b)},K=R=>{var b=qe("↕");C(R,b)};J(w,R=>{e(z),e(a),k(()=>e(z)===e(a).key)?R(I):R(K,!1)})}s(U),C(F,U)};J(B,F=>{e(a),k(()=>e(a).sortable)&&F(S)})}s(L),s(u),H(F=>{m=Oe(u,1,"svelte-i4fksl",null,m,F),$(D,(e(a),k(()=>e(a).label)))},[()=>({sortable:e(a).sortable,sorted:e(z)===e(a).key})]),j("click",u,()=>e(a).sortable&&Ze(e(a).key)),C(v,u)}),s(Ve),s(Pe);var Ue=o(Pe);fe(Ue,5,()=>e(oe),ue,(v,a)=>{var u=qt(),m=l(u),L=l(m);xe(L),s(m);var x=o(m);fe(x,1,()=>e(q),ue,(D,B)=>{var S=Ht(),F=l(S,!0);s(S),H((U,w)=>{Bt(S,`color: ${U??""}`),$(F,w)},[()=>(e(B),ve(Qe),e(a),e(re),k(()=>e(B).key.includes("p-value")||e(B).key.includes("P-value")?Qe(e(a)[e(B).key],e(re)):"inherit")),()=>(ve(Ge),e(a),e(B),k(()=>Ge(e(a)[e(B).key],e(B).key)))]),C(D,S)}),s(u),H(D=>_t(L,D),[()=>(e(V),e(a),k(()=>e(V).includes(e(a).name)))]),j("change",L,()=>et(e(a).name)),C(v,u)}),s(Ue),s($e),s(Se);var dt=o(Se,2);{var ft=v=>{var a=It(),u=l(a),m=l(u);s(u);var L=o(u,2),x=l(L),D=o(x,2),B=o(D,2);fe(B,1,()=>(e(E),e(h),k(()=>Array.from({length:Math.min(5,e(E))},(b,N)=>Math.max(1,e(h)-2)+N).filter(b=>b<=e(E)))),ue,(b,N)=>{var O=zt();let We;var ut=l(O,!0);s(O),H(pt=>{We=Oe(O,1,"page-btn svelte-i4fksl",null,We,pt),$(ut,e(N))},[()=>({active:e(N)===e(h)})]),j("click",O,()=>f(h,e(N))),C(b,O)});var S=o(B,2),F=o(S,2);s(L);var U=o(L,2),w=o(l(U),2);H(()=>{e(T),He(()=>{e(h)})});var I=l(w);I.value=I.__value=25;var K=o(I);K.value=K.__value=50;var R=o(K);R.value=R.__value=100,s(w),s(U),s(a),H(b=>{$(m,`Showing ${(e(h)-1)*e(T)+1}-${b??""} 
            of ${e(_),k(()=>e(_).length)??""} branches`),x.disabled=e(h)===1,D.disabled=e(h)===1,S.disabled=e(h)===e(E),F.disabled=e(h)===e(E)},[()=>(e(h),e(T),e(_),k(()=>Math.min(e(h)*e(T),e(_).length)))]),j("click",x,()=>f(h,1)),j("click",D,()=>ze(h,-1)),j("click",S,()=>ze(h)),j("click",F,()=>f(h,e(E))),Ie(w,()=>e(T),b=>f(T,b)),j("change",w,()=>f(h,1)),C(v,a)};J(dt,v=>{e(E)>1&&v(ft)})}s(Te),Y(2),yt(Ae,()=>e(re),v=>f(re,v)),Lt(De,()=>e(ge),v=>f(ge,v)),Ie(_e,()=>e(G),v=>f(G,v)),C(d,P)};J(tt,d=>{y()?d(st,!1):d(it)})}s(ke),C(t,ke),mt()}export{oi as A};
