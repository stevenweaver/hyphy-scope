import"./CWj6FrbW.js";import"./D_-aaKZl.js";import{o as et}from"./o3K4TFwT.js";import{p as tt,aq as Ce,o as P,q as B,aC as ce,j as G,i,aD as at,f as S,c as m,r as d,a as k,m as rt,aE as Pe,x as st,e as z,s as _,t as q,v as it,n as ot,b2 as ze,b3 as Ee}from"./DFDNEQV0.js";import{s as N}from"./y1NYNGaY.js";import{i as de,b as nt}from"./DwfxME3I.js";import{e as V,i as $}from"./D-5BVINM.js";import{i as lt,a as Oe,b as Te,c as ve,k as Be,d as ct,e as je,f as Fe,g as Q,j as H,m as ue,l as dt,n as ut,h as pt}from"./CO5CrjTu.js";import{r as Re,d as vt,a as ht,b as ft,e as mt}from"./m5uLgNLF.js";import{s as we}from"./D1jAydFb.js";import{i as bt}from"./DPzC27DL.js";import{p as Y}from"./rOhOFPaZ.js";import{i as yt,aI as De,b as gt,aJ as _t,M as xt,A as Mt,e as kt,f as St,g as Ct,k as Pt,aK as zt,F as K,G as Ae,H as pe,I as Et}from"./BWWySPzG.js";import{d as he}from"./Bi4WDgjP.js";import{b as Ot}from"./94Sq0pn4.js";import{b as Rt}from"./CWB3osUc.js";var wt=/\s/;function Dt(e){for(var a=e.length;a--&&wt.test(e.charAt(a)););return a}var Lt=/^\s+/;function It(e){return e&&e.slice(0,Dt(e)+1).replace(Lt,"")}var Le=NaN,Tt=/^[-+]0x[0-9a-f]+$/i,Bt=/^0b[01]+$/i,jt=/^0o[0-7]+$/i,Ft=parseInt;function At(e){if(typeof e=="number")return e;if(lt(e))return Le;if(Oe(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=Oe(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=It(e);var t=Bt.test(e);return t||jt.test(e)?Ft(e.slice(2),t?2:8):Tt.test(e)?Le:+e}var Ie=1/0,Nt=17976931348623157e292;function Wt(e){if(!e)return e===0?e:0;if(e=At(e),e===Ie||e===-Ie){var a=e<0?-1:1;return a*Nt}return e===e?e:0}function qt(e){var a=Wt(e),t=a%1;return a===a?t?a-t:a:0}function Vt(e,a,t,r){for(var s=e.length,o=t+-1;++o<s;)if(a(e[o],o,e))return o;return-1}function $t(e){return function(a,t,r){var s=Object(a);if(!Te(a)){var o=ve(t);a=Be(a),t=function(c){return o(s[c],c,s)}}var n=e(a,t,r);return n>-1?s[o?a[n]:n]:void 0}}var Ht=Math.max;function Xt(e,a,t){var r=e==null?0:e.length;if(!r)return-1;var s=t==null?0:qt(t);return s<0&&(s=Ht(r+s,0)),Vt(e,ve(a),s)}var Gt=$t(Xt);function Kt(e,a){var t=-1,r=Te(e)?Array(e.length):[];return ct(e,function(s,o,n){r[++t]=a(s,o,n)}),r}function Qt(e,a){var t=Fe(e)?je:Kt;return t(e,ve(a))}function Yt(e,a){return je(a,function(t){return e[t]})}function Ut(e){return e==null?[]:Yt(e,Be(e))}var Zt=Math.floor,Jt=Math.random;function ea(e,a){return e+Zt(Jt()*(a-e+1))}function Ne(e){var a=e.length;return a?e[ea(0,a-1)]:void 0}function ta(e){return Ne(Ut(e))}function aa(e){var a=Fe(e)?Ne:ta;return a(e)}const ra={ariaLabel:"tick",fill:null,stroke:"currentColor"};class sa extends xt{constructor(a,t,r){super(a,t,r,ra),Mt(this,r)}render(a,t,r,s,o){return kt("svg:g",o).call(St,this,s,o).call(this._transform,this,t).call(n=>n.selectAll().data(a).enter().append("line").call(Ct,this).attr("x1",this._x1(t,r,s)).attr("x2",this._x2(t,r,s)).attr("y1",this._y1(t,r,s)).attr("y2",this._y2(t,r,s)).call(Pt,this,r).call(zt,this,r,o)).node()}}class ia extends sa{constructor(a,t={}){const{x:r,y:s,inset:o=0,insetTop:n=o,insetBottom:c=o}=t;super(a,{x:{value:r,scale:"x"},y:{value:s,scale:"y",type:"band",optional:!0}},t),this.insetTop=De(n),this.insetBottom=De(c)}_transform(a,t,{x:r}){a.call(gt,t,{x:r},_t,0)}_x1(a,{x:t}){return r=>t[r]}_x2(a,{x:t}){return r=>t[r]}_y1({y:a},{y:t},{marginTop:r}){const{insetTop:s}=this;return t&&a?o=>t[o]+s:r+s}_y2({y:a},{y:t},{height:r,marginBottom:s}){const{insetBottom:o}=this;return t&&a?n=>t[n]+a.bandwidth()-o:r-s-o}}function oa(e,{x:a=yt,...t}={}){return new ia(e,{...t,x:a})}const O={Diversifying:"#e3243b",Neutral:"#444",Invariable:"#CCC"};function fe(e){var u;const a=Q(e,["MLE","LRT"])&&((u=aa(Q(e,["MLE","LRT"])[0]))==null?void 0:u.length)||0,t=!!Q(e,["substitutions"]),r=!!Gt(Q(e,["MLE","headers"]),h=>h[0]==="Variation p"),s=!1,o=Object.values(e["data partitions"]).map((h,w)=>Object.values(h.coverage[0]).map(D=>[+w+1,D+1])).flat(),n=e.input["number of sequences"],c=e.input["number of sites"],l=e.input["partition count"],v=5,R=Object.values(e["data partitions"]).map(h=>h.coverage[0].length);return{testedBranchCount:v,hasResamples:a,hasSubstitutions:t,hasSiteLRT:r,hasBackground:s,siteIndexPartitionCodon:o,numberOfSequences:n,numberOfSites:c,numberOfPartitions:l,partitionSizes:R}}function me(e,a){return Object.values(e.MLE.content).map(r=>r.filter(s=>s[6]<=+a).length).reduce((r,s)=>r+s,0)}function na(e,a){const t=me(e,a);return t?(Object.values(e.MLE.content).map(s=>s.filter(o=>o[6]<=+a)).map(s=>s.reduce((o,n)=>o+n[7],0)).reduce((s,o)=>s+o,0)/t).toFixed(2):"N/A"}function la(e,a){const t=fe(e),r=me(e,a),s=na(e,a),o=t.hasSiteLRT?Object.values(e.MLE.content).map(n=>n.filter(c=>c[11]<=+a).length).reduce((n,c)=>n+c,0):0;return[{number:e.input["number of sequences"],color:"asbestos",description:"sequences in the alignment",icon:"icon-options-vertical icons"},{number:e.input["number of sites"],color:"asbestos",description:"codon sites in the alignment",icon:"icon-options icons"},{number:e.input["partition count"],color:"asbestos",description:"partitions",icon:"icon-arrow-up icons"},{number:t.testedBranchCount,color:"asbestos",description:"median branches/partition used for testing",icon:"icon-share icons"},{number:t.hasResamples||"N/A",color:"asbestos",description:"parametric bootstrap replicates",icon:"icon-layers icons"},{number:r,color:"midnight_blue",description:"sites subject to episodic diversifying selection",icon:"icon-plus icons"},{number:s,color:"midnight_blue",description:"median branches with support for selection/selected site",icon:"icon-share icons"},{number:o,color:"midnight_blue",description:"sites with variable ω across branches",icon:"icon-energy icons"}]}function ca(e,a){const t=fe(e),r=[];let s=0;const o=Qt(e.MLE.headers,c=>(c[2]=c[0],c));return H(e["data partitions"],(c,l)=>{const v=e.MLE.content[l];H(c.coverage[0],(R,u)=>{const h={Partition:t.siteIndexPartitionCodon[s][0],Codon:t.siteIndexPartitionCodon[s][1],alpha:v[u][0],"beta-":v[u][1],"p-":v[u][2],"beta+":v[u][3],"p+":v[u][4],"p-value":v[u][6],Branches:v[u][7],class:"Neutral"};H(o,(D,L)=>{L<8&&(h[D[2]]=v[u][L])});let w="Neutral";v[u][0]===0&&v[u][1]===0&&v[u][3]===0?w="Invariable":v[u][6]<=+a&&(w="Diversifying"),h.class=w,r.push(h),s++})}),[r,{Partition:"Part.",Codon:"Codon",class:"Class",alpha:"α","beta-":"β-","p-":"p-","beta+":"β+","p+":"p+","p-value":"p-value",Branches:"Branches"},o]}function da(e,a=1){const t=[];let r=0;return H(e["branch attributes"],(s,o)=>{let n=0;H(s,(c,l)=>{c["Posterior prob omega class by site"]&&(H(c["Posterior prob omega class by site"][a],(v,R)=>{const u=e.MLE.content[o][R][4];t.push({Branch:l,Codon:R+r+1,Posterior:v,ER:ua(u,v)})}),n=c["Posterior prob omega class by site"][a].length)}),r+=n}),t}function ua(e,a){let t=e<1?e/(1-e):1/0,r=a<1?a/(1-a):1/0;return r>0?r/t:t===0?1:1/0}const x=1e4;function pa(e,a,t){return[{label:"p-values for selection",available:()=>!0},{label:"p-values for variability",available:()=>e},{label:"Site rates",available:()=>!0},{label:"Support for positive selection",available:()=>t.length>0},{label:"Dense rate plot",available:()=>!0},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>a>0}]}function va(e,a){return{"p-values for selection":`P-values derived from the ${a?"parametric bootstrap":"asymptotic mixture χ²"} test statistic for likelihood ratio tests for episodic diversifying selection. Solid line = user selected significance threshold.`,"p-values for variability":"P-values derived from the asymptotic mixture χ²₂ test statistic for likelihood ratio tests for variable ω at this site. Solid line = user selected significance threshold.","Site rates":`Site-level rate maximum likelihood estimates (MLE). For each site, the horizontal tick depicts the synonymous rate (α) MLE. Circles show non-synonymous (β- and β+) MLEs, and the size of a circle reflects the weight parameter inferred for the corresponding rate. The non-synonymous rate estimates are connected by a vertical line to enhance readability and show the range of inferred non-synonymous rates and their relationship to the synonymous rate. Estimates above ${x} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α), non-synonymous rates (β-, β+), and non-synonymous weights (p-,p+) at each site. Estimates above ${x} are censored at this value. p-values for episodic diversifying selection are also shown`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${x} are censored at this value.`,"Support for positive selection":"Empirical Bayes Factors for ω>1 at a particular branch and site (only tested branches are included).","Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[e]||""}function ha(e,a){return K({width:800,height:300,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"p-value",type:"log",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[Ae([a],{stroke:"black",strokeWidth:2,strokeDasharray:"4,2"}),he(e,{x:"Codon",y:"p-value",fill:"class",r:3,tip:!0})]})}function fa(e){const a=e.flatMap(t=>{const r=Math.min(t.alpha,x),s=Math.min(t["beta-"],x),o=Math.min(t["beta+"],x);return[{codon:t.Codon,rate:r,type:"alpha",weight:1,class:t.class},{codon:t.Codon,rate:s,type:"beta-",weight:t["p-"],class:t.class},{codon:t.Codon,rate:o,type:"beta+",weight:t["p+"],class:t.class}]});return K({width:800,height:400,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"Rate estimate",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[oa(a.filter(t=>t.type==="alpha"),{x:"codon",y:"rate",stroke:"class",strokeWidth:2}),he(a.filter(t=>t.type.startsWith("beta")),{x:"codon",y:"rate",fill:"class",r:t=>Math.sqrt(t.weight)*8,fillOpacity:.7,tip:!0}),ut(e.map(t=>({codon:t.Codon,y1:Math.min(t["beta-"],x),y2:Math.min(t["beta+"],x),class:t.class})),{x:"codon",y1:"y1",y2:"y2",stroke:"class",strokeWidth:1,strokeOpacity:.5})]})}function ma(e){const a=e.flatMap(t=>[{codon:t.Codon,rate:Math.min(t.alpha,x),type:"α",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta-"],x),type:"β-",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta+"],x),type:"β+",class:t.class,pvalue:t["p-value"]}]);return K({width:800,height:500,facet:{data:a,y:"type",marginRight:80},x:{label:"Codon position"},y:{label:"Rate estimate",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[Rt(a,{x:"codon",y:"rate",fill:"class",fillOpacity:.7,tip:!0})]})}function ba(e){const a=e.map(l=>Math.min(l.alpha,x)),t=e.map(l=>Math.min(l["beta-"],x)),r=e.map(l=>Math.min(l["beta+"],x)),s=ue(a),o=ue(t),n=ue(r),c=[...a.map(l=>({value:l,type:"α"})),...t.map(l=>({value:l,type:"β-"})),...r.map(l=>({value:l,type:"β+"}))];return K({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},color:{domain:["α","β-","β+"],range:["steelblue","orange","red"]},marks:[dt(c,Ot({y:"count"},{x:"value",fill:"type",fillOpacity:.3,curve:"basis"})),pe([s],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),pe([o],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),pe([n],{stroke:"red",strokeWidth:2,strokeDasharray:"4,2"}),Et([{x:s,y:0,text:`α: ${s.toFixed(2)}`,type:"α"},{x:o,y:0,text:`β-: ${o.toFixed(2)}`,type:"β-"},{x:n,y:0,text:`β+: ${n.toFixed(2)}`,type:"β+"}],{x:"x",y:"y",text:"text",fill:l=>l.type==="α"?"steelblue":l.type==="β-"?"orange":"red",dy:-10,fontSize:12})]})}function ya(e){return!e||e.length===0?null:K({width:800,height:400,x:{label:"Codon position",grid:!0},y:{label:"Empirical Bayes Factor",type:"log",grid:!0},marks:[he(e,{x:"Codon",y:"ER",fill:"Branch",r:3,fillOpacity:.7,tip:!0}),Ae([1],{stroke:"black",strokeDasharray:"2,2"})]})}function ga(e,a,t,r){switch(e){case"p-values for selection":return ha(a,t);case"Site rates":return fa(a);case"Dense rate plot":return ma(a);case"Rate density plots":return ba(a);case"Support for positive selection":return ya(r||[]);default:return null}}var _a=S('<div class="loading svelte-zch4d7">Loading MEME data...</div>'),xa=S('<div class="tile svelte-zch4d7"><div class="tile-number svelte-zch4d7"> </div> <div class="tile-description svelte-zch4d7"> </div></div>'),Ma=S('<div class="summary-tiles svelte-zch4d7"></div>'),ka=S("<option> </option>"),Sa=S('<label class="checkbox-label svelte-zch4d7"><input type="checkbox"/> </label>'),Ca=S('<th class="svelte-zch4d7"> </th>'),Pa=S('<td class="svelte-zch4d7"><!></td>'),za=S('<tr class="svelte-zch4d7"></tr>'),Ea=S('<div class="table-container svelte-zch4d7"><table class="svelte-zch4d7"><thead class="svelte-zch4d7"><tr></tr></thead><tbody class="svelte-zch4d7"></tbody></table></div>'),Oa=S('<p class="no-data svelte-zch4d7">No sites match the current filter criteria.</p>'),Ra=S(`<!> <div class="controls-section svelte-zch4d7"><div class="control-group svelte-zch4d7"><label for="pvalue-threshold" class="svelte-zch4d7">p-value threshold:</label> <input id="pvalue-threshold" type="number" min="0" max="1" step="0.01" class="svelte-zch4d7"/></div> <div class="control-group svelte-zch4d7"><label for="plot-select" class="svelte-zch4d7">Plot type:</label> <select id="plot-select" class="svelte-zch4d7"></select></div> <div class="control-group svelte-zch4d7"><fieldset><legend>Show classes:</legend> <div class="checkbox-group svelte-zch4d7"></div></fieldset></div></div> <div class="plot-section svelte-zch4d7"><h3 class="svelte-zch4d7">Figure 1</h3> <p class="plot-description svelte-zch4d7"> </p> <div class="plot-container svelte-zch4d7"></div></div> <div class="table-section svelte-zch4d7"><h3>Table 1</h3> <p class="table-description"> </p> <!></div> <div class="citation svelte-zch4d7"><h3>Citation</h3> <code class="svelte-zch4d7">Murrell B, Wertheim JO, Moola S, Weighill T, Scheffler K, Kosakovsky Pond SL. 
        Detecting individual sites subject to episodic diversifying selection. 
        PLoS Genet. 2012;8(7):e1002764. doi:10.1371/journal.pgen.1002764</code></div>`,1),wa=S('<div class="meme-visualization svelte-zch4d7"><!></div>');function Ka(e,a){tt(a,!1);const t=[];let r=Y(a,"data",8,null),s=Y(a,"pvalueThreshold",12,.1),o=Y(a,"showColumns",28,()=>["Diversifying","Neutral","Invariable"]),n=Y(a,"plotType",12,"p-values for selection"),c={},l=B([[],[],{}]),v=B([]),R=B(""),u=B([]),h=B(),w=B(0),D=[],L=B(!1),be=[],I=B([]);function We(p){return O[p]||"#000000"}function ye(){be=i(l)[0]||[],P(I,be.filter(p=>o().includes(p.class)))}async function ge(){var C;if(!((C=r())!=null&&C.MLE))return;c=fe(r()),P(l,ca(r(),s())),P(v,la(r(),s())),P(w,me(r(),s()));try{D=da(r())}catch{D=[]}const p=pa(c.hasSiteLRT,c.hasResamples,D);P(u,p.filter(j=>j.available(r())).map(j=>j.label)),!i(u).includes(n())&&i(u).length>0&&n(i(u)[0]),ye(),P(L,!0),await Ce(),i(h)&&U()}function U(){if(!(!r()||!n()||i(I).length===0||!i(h))){P(R,va(n(),c.hasResamples)),Pe(h,i(h).innerHTML="");try{const p=ga(n(),i(I),s(),D);p&&i(h).appendChild(p)}catch(p){console.error("Error creating plot:",p),Pe(h,i(h).innerHTML='<p class="error">Error rendering plot</p>')}}}et(async()=>{await Ce(),r()&&(P(L,!1),await ge())});function qe(p,C){return C?C(p):String(p)}ce(()=>(G(r()),G(s())),()=>{r()&&s()!==void 0&&(P(L,!1),ge())}),ce(()=>(G(o()),i(l)),()=>{var p;o()&&((p=i(l)[0])==null?void 0:p.length)>0&&(ye(),U())}),ce(()=>(G(n()),i(I),i(h)),()=>{n()&&i(I).length>0&&i(h)&&U()}),at(),bt();var Z=wa(),Ve=m(Z);{var $e=p=>{var C=_a();k(p,C)},He=p=>{var C=Ra(),j=st(C);{var Xe=y=>{var f=Ma();V(f,5,()=>i(v),$,(g,b)=>{var M=xa(),E=m(M),F=m(E,!0);d(E);var A=_(E,2),T=m(A,!0);d(A),d(M),q(()=>{we(E,`color: ${i(b),z(()=>i(b).color||"#333")??""}`),N(F,(i(b),z(()=>i(b).number))),N(T,(i(b),z(()=>i(b).description)))}),k(g,M)}),d(f),k(y,f)};de(j,y=>{i(L),i(v),z(()=>i(L)&&i(v).length>0)&&y(Xe)})}var J=_(j,2),ee=m(J),_e=_(m(ee),2);Re(_e),d(ee);var te=_(ee,2),ae=_(m(te),2);q(()=>{n(),it(()=>{i(u)})}),V(ae,5,()=>i(u),$,(y,f)=>{var g=ka(),b=m(g,!0);d(g);var M={};q(()=>{N(b,i(f)),M!==(M=i(f))&&(g.value=(g.__value=i(f))??"")}),k(y,g)}),d(ae),d(te);var xe=_(te,2),Me=m(xe),ke=_(m(Me),2);V(ke,5,()=>(G(O),z(()=>Object.keys(O))),$,(y,f)=>{var g=Sa(),b=m(g);Re(b);var M,E=_(b);d(g),q(F=>{we(g,`border-bottom: 2px solid ${F??""}`),M!==(M=i(f))&&(b.value=(b.__value=i(f))??""),N(E,` ${i(f)??""}`)},[()=>(i(f),z(()=>We(i(f))))]),vt(t,[],b,()=>(i(f),o()),o),k(y,g)}),d(ke),d(Me),d(xe),d(J);var re=_(J,2),se=_(m(re),2),Ge=m(se,!0);d(se);var Ke=_(se,2);nt(Ke,y=>P(h,y),()=>i(h)),d(re);var Se=_(re,2),ie=_(m(Se),2),Qe=m(ie);d(ie);var Ye=_(ie,2);{var Ue=y=>{var f=Ea(),g=m(f),b=m(g),M=m(b);V(M,5,()=>(i(l),z(()=>i(l)[1])),$,(F,A)=>{var T=ze(()=>Ee(i(A),2));let oe=()=>i(T)[0],ne=()=>i(T)[1];var W=Ca(),X=m(W,!0);d(W),q(()=>{mt(W,"title",ne()),N(X,oe())}),k(F,W)}),d(M),d(b);var E=_(b);V(E,5,()=>i(I),$,(F,A)=>{var T=za();V(T,5,()=>(i(l),z(()=>i(l)[1])),$,(oe,ne)=>{var W=ze(()=>Ee(i(ne),1));let X=()=>i(W)[0];var le=Pa(),Je=m(le);pt(Je,()=>(i(A),X(),i(l),z(()=>qe(i(A)[X()],i(l)[2][X()])))),d(le),k(oe,le)}),d(T),k(F,T)}),d(E),d(g),d(f),k(y,f)},Ze=y=>{var f=Oa();k(y,f)};de(Ye,y=>{i(I),z(()=>i(I).length>0)?y(Ue):y(Ze,!1)})}d(Se),ot(2),q(()=>{N(Ge,i(R)),N(Qe,`${i(w)??""} sites found to be under positive selection at p ≤ ${s()??""}`)}),ht(_e,s),ft(ae,n),k(p,C)};de(Ve,p=>{r()?p(He,!1):p($e)})}d(Z),k(e,Z),rt()}export{Ka as M};
