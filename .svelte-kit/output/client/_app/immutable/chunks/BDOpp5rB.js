import"./CWj6FrbW.js";import"./DwqWfmFf.js";import{o as Je}from"./Cwh0FcVT.js";import{p as et,y as Se,o as z,q as I,z as ce,j as Q,i,A as tt,f as S,c as m,r as u,a as k,m as at,B as Ce,x as rt,e as P,s as _,t as q,v as st,n as it,C as ze,E as Pe}from"./BAjxKRmT.js";import{s as N}from"./BzaWH1un.js";import{i as ue,b as ot}from"./CNWIBFBx.js";import{o as nt,p as Ee,q as Te,t as ve,u as Be,v as lt,w as Ie,x as je,y as K,z as X,r as Oe,e as V,i as $,j as ct,a as ut,b as dt,s as pt}from"./DJlT08gO.js";import{m as de,a as vt,l as ht,h as ft}from"./mVHckqdF.js";import{s as Re}from"./BVzcOKxO.js";import{i as mt}from"./HQjPdDHY.js";import{p as Y}from"./Dj7YHM2X.js";import{i as bt,aa as we,b as yt,ab as gt,M as _t,F as xt,e as Mt,f as kt,g as St,k as Ct,a9 as zt,z as G,D as Ae,A as pe,B as Pt}from"./DMkSVGaj.js";import{d as he}from"./DHrXX71C.js";import{b as Et}from"./PzlVfG0z.js";import{b as Ot}from"./K_UNyUlX.js";var Rt=/\s/;function wt(e){for(var a=e.length;a--&&Rt.test(e.charAt(a)););return a}var Dt=/^\s+/;function Lt(e){return e&&e.slice(0,wt(e)+1).replace(Dt,"")}var De=NaN,Tt=/^[-+]0x[0-9a-f]+$/i,Bt=/^0b[01]+$/i,It=/^0o[0-7]+$/i,jt=parseInt;function At(e){if(typeof e=="number")return e;if(nt(e))return De;if(Ee(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=Ee(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=Lt(e);var t=Bt.test(e);return t||It.test(e)?jt(e.slice(2),t?2:8):Tt.test(e)?De:+e}var Le=1/0,Ft=17976931348623157e292;function Nt(e){if(!e)return e===0?e:0;if(e=At(e),e===Le||e===-Le){var a=e<0?-1:1;return a*Ft}return e===e?e:0}function Wt(e){var a=Nt(e),t=a%1;return a===a?t?a-t:a:0}function qt(e,a,t,r){for(var s=e.length,o=t+-1;++o<s;)if(a(e[o],o,e))return o;return-1}function Vt(e){return function(a,t,r){var s=Object(a);if(!Te(a)){var o=ve(t);a=Be(a),t=function(c){return o(s[c],c,s)}}var n=e(a,t,r);return n>-1?s[o?a[n]:n]:void 0}}var $t=Math.max;function Xt(e,a,t){var r=e==null?0:e.length;if(!r)return-1;var s=t==null?0:Wt(t);return s<0&&(s=$t(r+s,0)),qt(e,ve(a),s)}var Ht=Vt(Xt);function Qt(e,a){var t=-1,r=Te(e)?Array(e.length):[];return lt(e,function(s,o,n){r[++t]=a(s,o,n)}),r}function Gt(e,a){var t=je(e)?Ie:Qt;return t(e,ve(a))}function Kt(e,a){return Ie(a,function(t){return e[t]})}function Yt(e){return e==null?[]:Kt(e,Be(e))}var Ut=Math.floor,Zt=Math.random;function Jt(e,a){return e+Ut(Zt()*(a-e+1))}function Fe(e){var a=e.length;return a?e[Jt(0,a-1)]:void 0}function ea(e){return Fe(Yt(e))}function ta(e){var a=je(e)?Fe:ea;return a(e)}const aa={ariaLabel:"tick",fill:null,stroke:"currentColor"};class ra extends _t{constructor(a,t,r){super(a,t,r,aa),xt(this,r)}render(a,t,r,s,o){return Mt("svg:g",o).call(kt,this,s,o).call(this._transform,this,t).call(n=>n.selectAll().data(a).enter().append("line").call(St,this).attr("x1",this._x1(t,r,s)).attr("x2",this._x2(t,r,s)).attr("y1",this._y1(t,r,s)).attr("y2",this._y2(t,r,s)).call(Ct,this,r).call(zt,this,r,o)).node()}}class sa extends ra{constructor(a,t={}){const{x:r,y:s,inset:o=0,insetTop:n=o,insetBottom:c=o}=t;super(a,{x:{value:r,scale:"x"},y:{value:s,scale:"y",type:"band",optional:!0}},t),this.insetTop=we(n),this.insetBottom=we(c)}_transform(a,t,{x:r}){a.call(yt,t,{x:r},gt,0)}_x1(a,{x:t}){return r=>t[r]}_x2(a,{x:t}){return r=>t[r]}_y1({y:a},{y:t},{marginTop:r}){const{insetTop:s}=this;return t&&a?o=>t[o]+s:r+s}_y2({y:a},{y:t},{height:r,marginBottom:s}){const{insetBottom:o}=this;return t&&a?n=>t[n]+a.bandwidth()-o:r-s-o}}function ia(e,{x:a=bt,...t}={}){return new sa(e,{...t,x:a})}const O={Diversifying:"#e3243b",Neutral:"#444",Invariable:"#CCC"};function fe(e){var d;const a=K(e,["MLE","LRT"])&&((d=ta(K(e,["MLE","LRT"])[0]))==null?void 0:d.length)||0,t=!!K(e,["substitutions"]),r=!!Ht(K(e,["MLE","headers"]),h=>h[0]==="Variation p"),s=!1,o=Object.values(e["data partitions"]).map((h,w)=>Object.values(h.coverage[0]).map(D=>[+w+1,D+1])).flat(),n=e.input["number of sequences"],c=e.input["number of sites"],l=e.input["partition count"],v=5,R=Object.values(e["data partitions"]).map(h=>h.coverage[0].length);return{testedBranchCount:v,hasResamples:a,hasSubstitutions:t,hasSiteLRT:r,hasBackground:s,siteIndexPartitionCodon:o,numberOfSequences:n,numberOfSites:c,numberOfPartitions:l,partitionSizes:R}}function me(e,a){return Object.values(e.MLE.content).map(r=>r.filter(s=>s[6]<=+a).length).reduce((r,s)=>r+s,0)}function oa(e,a){const t=me(e,a);return t?(Object.values(e.MLE.content).map(s=>s.filter(o=>o[6]<=+a)).map(s=>s.reduce((o,n)=>o+n[7],0)).reduce((s,o)=>s+o,0)/t).toFixed(2):"N/A"}function na(e,a){const t=fe(e),r=me(e,a),s=oa(e,a),o=t.hasSiteLRT?Object.values(e.MLE.content).map(n=>n.filter(c=>c[11]<=+a).length).reduce((n,c)=>n+c,0):0;return[{number:e.input["number of sequences"],color:"asbestos",description:"sequences in the alignment",icon:"icon-options-vertical icons"},{number:e.input["number of sites"],color:"asbestos",description:"codon sites in the alignment",icon:"icon-options icons"},{number:e.input["partition count"],color:"asbestos",description:"partitions",icon:"icon-arrow-up icons"},{number:t.testedBranchCount,color:"asbestos",description:"median branches/partition used for testing",icon:"icon-share icons"},{number:t.hasResamples||"N/A",color:"asbestos",description:"parametric bootstrap replicates",icon:"icon-layers icons"},{number:r,color:"midnight_blue",description:"sites subject to episodic diversifying selection",icon:"icon-plus icons"},{number:s,color:"midnight_blue",description:"median branches with support for selection/selected site",icon:"icon-share icons"},{number:o,color:"midnight_blue",description:"sites with variable ω across branches",icon:"icon-energy icons"}]}function la(e,a){const t=fe(e),r=[];let s=0;const o=Gt(e.MLE.headers,c=>(c[2]=c[0],c));return X(e["data partitions"],(c,l)=>{const v=e.MLE.content[l];X(c.coverage[0],(R,d)=>{const h={Partition:t.siteIndexPartitionCodon[s][0],Codon:t.siteIndexPartitionCodon[s][1],alpha:v[d][0],"beta-":v[d][1],"p-":v[d][2],"beta+":v[d][3],"p+":v[d][4],"p-value":v[d][6],Branches:v[d][7],class:"Neutral"};X(o,(D,L)=>{L<8&&(h[D[2]]=v[d][L])});let w="Neutral";v[d][0]===0&&v[d][1]===0&&v[d][3]===0?w="Invariable":v[d][6]<=+a&&(w="Diversifying"),h.class=w,r.push(h),s++})}),[r,{Partition:"Part.",Codon:"Codon",class:"Class",alpha:"α","beta-":"β-","p-":"p-","beta+":"β+","p+":"p+","p-value":"p-value",Branches:"Branches"},o]}function ca(e,a=1){const t=[];let r=0;return X(e["branch attributes"],(s,o)=>{let n=0;X(s,(c,l)=>{c["Posterior prob omega class by site"]&&(X(c["Posterior prob omega class by site"][a],(v,R)=>{const d=e.MLE.content[o][R][4];t.push({Branch:l,Codon:R+r+1,Posterior:v,ER:ua(d,v)})}),n=c["Posterior prob omega class by site"][a].length)}),r+=n}),t}function ua(e,a){let t=e<1?e/(1-e):1/0,r=a<1?a/(1-a):1/0;return r>0?r/t:t===0?1:1/0}const x=1e4;function da(e,a,t){return[{label:"p-values for selection",available:()=>!0},{label:"p-values for variability",available:()=>e},{label:"Site rates",available:()=>!0},{label:"Support for positive selection",available:()=>t.length>0},{label:"Dense rate plot",available:()=>!0},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>a>0}]}function pa(e,a){return{"p-values for selection":`P-values derived from the ${a?"parametric bootstrap":"asymptotic mixture χ²"} test statistic for likelihood ratio tests for episodic diversifying selection. Solid line = user selected significance threshold.`,"p-values for variability":"P-values derived from the asymptotic mixture χ²₂ test statistic for likelihood ratio tests for variable ω at this site. Solid line = user selected significance threshold.","Site rates":`Site-level rate maximum likelihood estimates (MLE). For each site, the horizontal tick depicts the synonymous rate (α) MLE. Circles show non-synonymous (β- and β+) MLEs, and the size of a circle reflects the weight parameter inferred for the corresponding rate. The non-synonymous rate estimates are connected by a vertical line to enhance readability and show the range of inferred non-synonymous rates and their relationship to the synonymous rate. Estimates above ${x} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α), non-synonymous rates (β-, β+), and non-synonymous weights (p-,p+) at each site. Estimates above ${x} are censored at this value. p-values for episodic diversifying selection are also shown`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${x} are censored at this value.`,"Support for positive selection":"Empirical Bayes Factors for ω>1 at a particular branch and site (only tested branches are included).","Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[e]||""}function va(e,a){return G({width:800,height:300,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"p-value",type:"log",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[Ae([a],{stroke:"black",strokeWidth:2,strokeDasharray:"4,2"}),he(e,{x:"Codon",y:"p-value",fill:"class",r:3,tip:!0})]})}function ha(e){const a=e.flatMap(t=>{const r=Math.min(t.alpha,x),s=Math.min(t["beta-"],x),o=Math.min(t["beta+"],x);return[{codon:t.Codon,rate:r,type:"alpha",weight:1,class:t.class},{codon:t.Codon,rate:s,type:"beta-",weight:t["p-"],class:t.class},{codon:t.Codon,rate:o,type:"beta+",weight:t["p+"],class:t.class}]});return G({width:800,height:400,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"Rate estimate",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[ia(a.filter(t=>t.type==="alpha"),{x:"codon",y:"rate",stroke:"class",strokeWidth:2}),he(a.filter(t=>t.type.startsWith("beta")),{x:"codon",y:"rate",fill:"class",r:t=>Math.sqrt(t.weight)*8,fillOpacity:.7,tip:!0}),ht(e.map(t=>({codon:t.Codon,y1:Math.min(t["beta-"],x),y2:Math.min(t["beta+"],x),class:t.class})),{x:"codon",y1:"y1",y2:"y2",stroke:"class",strokeWidth:1,strokeOpacity:.5})]})}function fa(e){const a=e.flatMap(t=>[{codon:t.Codon,rate:Math.min(t.alpha,x),type:"α",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta-"],x),type:"β-",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta+"],x),type:"β+",class:t.class,pvalue:t["p-value"]}]);return G({width:800,height:500,facet:{data:a,y:"type",marginRight:80},x:{label:"Codon position"},y:{label:"Rate estimate",grid:!0},color:{type:"categorical",domain:Object.keys(O),range:Object.values(O),legend:!0},marks:[Ot(a,{x:"codon",y:"rate",fill:"class",fillOpacity:.7,tip:!0})]})}function ma(e){const a=e.map(l=>Math.min(l.alpha,x)),t=e.map(l=>Math.min(l["beta-"],x)),r=e.map(l=>Math.min(l["beta+"],x)),s=de(a),o=de(t),n=de(r),c=[...a.map(l=>({value:l,type:"α"})),...t.map(l=>({value:l,type:"β-"})),...r.map(l=>({value:l,type:"β+"}))];return G({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},color:{domain:["α","β-","β+"],range:["steelblue","orange","red"]},marks:[vt(c,Et({y:"count"},{x:"value",fill:"type",fillOpacity:.3,curve:"basis"})),pe([s],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),pe([o],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),pe([n],{stroke:"red",strokeWidth:2,strokeDasharray:"4,2"}),Pt([{x:s,y:0,text:`α: ${s.toFixed(2)}`,type:"α"},{x:o,y:0,text:`β-: ${o.toFixed(2)}`,type:"β-"},{x:n,y:0,text:`β+: ${n.toFixed(2)}`,type:"β+"}],{x:"x",y:"y",text:"text",fill:l=>l.type==="α"?"steelblue":l.type==="β-"?"orange":"red",dy:-10,fontSize:12})]})}function ba(e){return!e||e.length===0?null:G({width:800,height:400,x:{label:"Codon position",grid:!0},y:{label:"Empirical Bayes Factor",type:"log",grid:!0},marks:[he(e,{x:"Codon",y:"ER",fill:"Branch",r:3,fillOpacity:.7,tip:!0}),Ae([1],{stroke:"black",strokeDasharray:"2,2"})]})}function ya(e,a,t,r){switch(e){case"p-values for selection":return va(a,t);case"Site rates":return ha(a);case"Dense rate plot":return fa(a);case"Rate density plots":return ma(a);case"Support for positive selection":return ba(r||[]);default:return null}}var ga=S('<div class="loading svelte-zch4d7">Loading MEME data...</div>'),_a=S('<div class="tile svelte-zch4d7"><div class="tile-number svelte-zch4d7"> </div> <div class="tile-description svelte-zch4d7"> </div></div>'),xa=S('<div class="summary-tiles svelte-zch4d7"></div>'),Ma=S("<option> </option>"),ka=S('<label class="checkbox-label svelte-zch4d7"><input type="checkbox"/> </label>'),Sa=S('<th class="svelte-zch4d7"> </th>'),Ca=S('<td class="svelte-zch4d7"><!></td>'),za=S('<tr class="svelte-zch4d7"></tr>'),Pa=S('<div class="table-container svelte-zch4d7"><table class="svelte-zch4d7"><thead class="svelte-zch4d7"><tr></tr></thead><tbody class="svelte-zch4d7"></tbody></table></div>'),Ea=S('<p class="no-data svelte-zch4d7">No sites match the current filter criteria.</p>'),Oa=S(`<!> <div class="controls-section svelte-zch4d7"><div class="control-group svelte-zch4d7"><label for="pvalue-threshold" class="svelte-zch4d7">p-value threshold:</label> <input id="pvalue-threshold" type="number" min="0" max="1" step="0.01" class="svelte-zch4d7"/></div> <div class="control-group svelte-zch4d7"><label for="plot-select" class="svelte-zch4d7">Plot type:</label> <select id="plot-select" class="svelte-zch4d7"></select></div> <div class="control-group svelte-zch4d7"><label class="svelte-zch4d7">Show classes:</label> <div class="checkbox-group svelte-zch4d7"></div></div></div> <div class="plot-section svelte-zch4d7"><h3 class="svelte-zch4d7">Figure 1</h3> <p class="plot-description svelte-zch4d7"> </p> <div class="plot-container svelte-zch4d7"></div></div> <div class="table-section svelte-zch4d7"><h3>Table 1</h3> <p class="table-description"> </p> <!></div> <div class="citation svelte-zch4d7"><h3>Citation</h3> <code class="svelte-zch4d7">Murrell B, Wertheim JO, Moola S, Weighill T, Scheffler K, Kosakovsky Pond SL. 
        Detecting individual sites subject to episodic diversifying selection. 
        PLoS Genet. 2012;8(7):e1002764. doi:10.1371/journal.pgen.1002764</code></div>`,1),Ra=S('<div class="meme-visualization svelte-zch4d7"><!></div>');function Ha(e,a){et(a,!1);const t=[];let r=Y(a,"data",8,null),s=Y(a,"pvalueThreshold",12,.1),o=Y(a,"showColumns",28,()=>["Diversifying","Neutral","Invariable"]),n=Y(a,"plotType",12,"p-values for selection"),c={},l=I([[],[],{}]),v=I([]),R=I(""),d=I([]),h=I(),w=I(0),D=[],L=I(!1),be=[],T=I([]);function Ne(p){return O[p]||"#000000"}function ye(){be=i(l)[0]||[],z(T,be.filter(p=>o().includes(p.class)))}async function ge(){var C;if(!((C=r())!=null&&C.MLE))return;c=fe(r()),z(l,la(r(),s())),z(v,na(r(),s())),z(w,me(r(),s()));try{D=ca(r())}catch{D=[]}const p=da(c.hasSiteLRT,c.hasResamples,D);z(d,p.filter(j=>j.available(r())).map(j=>j.label)),!i(d).includes(n())&&i(d).length>0&&n(i(d)[0]),ye(),z(L,!0),await Se(),i(h)&&U()}function U(){if(!(!r()||!n()||i(T).length===0||!i(h))){z(R,pa(n(),c.hasResamples)),Ce(h,i(h).innerHTML="");try{const p=ya(n(),i(T),s(),D);p&&i(h).appendChild(p)}catch(p){console.error("Error creating plot:",p),Ce(h,i(h).innerHTML='<p class="error">Error rendering plot</p>')}}}Je(async()=>{await Se(),r()&&(z(L,!1),await ge())});function We(p,C){return C?C(p):String(p)}ce(()=>(Q(r()),Q(s())),()=>{r()&&s()!==void 0&&(z(L,!1),ge())}),ce(()=>(Q(o()),i(l)),()=>{var p;o()&&((p=i(l)[0])==null?void 0:p.length)>0&&(ye(),U())}),ce(()=>(Q(n()),i(T),i(h)),()=>{n()&&i(T).length>0&&i(h)&&U()}),tt(),mt();var Z=Ra(),qe=m(Z);{var Ve=p=>{var C=ga();k(p,C)},$e=p=>{var C=Oa(),j=rt(C);{var Xe=y=>{var f=xa();V(f,5,()=>i(v),$,(g,b)=>{var M=_a(),E=m(M),A=m(E,!0);u(E);var F=_(E,2),B=m(F,!0);u(F),u(M),q(()=>{Re(E,`color: ${i(b),P(()=>i(b).color||"#333")??""}`),N(A,(i(b),P(()=>i(b).value))),N(B,(i(b),P(()=>i(b).description)))}),k(g,M)}),u(f),k(y,f)};ue(j,y=>{i(L),i(v),P(()=>i(L)&&i(v).length>0)&&y(Xe)})}var J=_(j,2),ee=m(J),_e=_(m(ee),2);Oe(_e),u(ee);var te=_(ee,2),ae=_(m(te),2);q(()=>{n(),st(()=>{i(d)})}),V(ae,5,()=>i(d),$,(y,f)=>{var g=Ma(),b=m(g,!0);u(g);var M={};q(()=>{N(b,i(f)),M!==(M=i(f))&&(g.value=(g.__value=i(f))??"")}),k(y,g)}),u(ae),u(te);var xe=_(te,2),Me=_(m(xe),2);V(Me,5,()=>(Q(O),P(()=>Object.keys(O))),$,(y,f)=>{var g=ka(),b=m(g);Oe(b);var M,E=_(b);u(g),q(A=>{Re(g,`border-bottom: 2px solid ${A??""}`),M!==(M=i(f))&&(b.value=(b.__value=i(f))??""),N(E,` ${i(f)??""}`)},[()=>(i(f),P(()=>Ne(i(f))))]),ct(t,[],b,()=>(i(f),o()),o),k(y,g)}),u(Me),u(xe),u(J);var re=_(J,2),se=_(m(re),2),He=m(se,!0);u(se);var Qe=_(se,2);ot(Qe,y=>z(h,y),()=>i(h)),u(re);var ke=_(re,2),ie=_(m(ke),2),Ge=m(ie);u(ie);var Ke=_(ie,2);{var Ye=y=>{var f=Pa(),g=m(f),b=m(g),M=m(b);V(M,5,()=>(i(l),P(()=>i(l)[1])),$,(A,F)=>{var B=ze(()=>Pe(i(F),2));let oe=()=>i(B)[0],ne=()=>i(B)[1];var W=Sa(),H=m(W,!0);u(W),q(()=>{pt(W,"title",ne()),N(H,oe())}),k(A,W)}),u(M),u(b);var E=_(b);V(E,5,()=>i(T),$,(A,F)=>{var B=za();V(B,5,()=>(i(l),P(()=>i(l)[1])),$,(oe,ne)=>{var W=ze(()=>Pe(i(ne),1));let H=()=>i(W)[0];var le=Ca(),Ze=m(le);ft(Ze,()=>(i(F),H(),i(l),P(()=>We(i(F)[H()],i(l)[2][H()])))),u(le),k(oe,le)}),u(B),k(A,B)}),u(E),u(g),u(f),k(y,f)},Ue=y=>{var f=Ea();k(y,f)};ue(Ke,y=>{i(T),P(()=>i(T).length>0)?y(Ye):y(Ue,!1)})}u(ke),it(2),q(()=>{N(He,i(R)),N(Ge,`${i(w)??""} sites found to be under positive selection at p ≤ ${s()??""}`)}),ut(_e,s),dt(ae,n),k(p,C)};ue(qe,p=>{r()?p($e,!1):p(Ve)})}u(Z),k(e,Z),at()}export{Ha as M};
