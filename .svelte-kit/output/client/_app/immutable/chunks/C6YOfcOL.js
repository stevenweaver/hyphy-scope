import"./CWj6FrbW.js";import"./DwqWfmFf.js";import{o as we}from"./Cwh0FcVT.js";import{p as Ce,y as Ut,o as x,q as g,z as $t,j as ut,i as t,A as Fe,f as p,c as o,r as s,a as n,m as Pe,B as Ht,x as gt,e as _,s as i,t as P,v as Le,n as Be,C as Kt,D as Xt,E as Gt,F as It,w as Jt}from"./BAjxKRmT.js";import{s as $,e as X}from"./BzaWH1un.js";import{i as W,b as Ne}from"./CNWIBFBx.js";import{C as V,d as Oe,f as $e,h as Ee,r as Zt,e as U,i as G,j as Te,a as je,b as Re,s as Ae}from"./DJlT08gO.js";import{m as te,a as ee,l as re,h as We}from"./mVHckqdF.js";import{l as ae,s as xt}from"./BQtjgPEE.js";import{s as se}from"./BVzcOKxO.js";import{i as Ve}from"./HQjPdDHY.js";import{p as kt}from"./Dj7YHM2X.js";import{z as Dt,A as le,B as oe,C as Mt,D as ie}from"./DMkSVGaj.js";import{b as St}from"./PzlVfG0z.js";import{d as ne}from"./DHrXX71C.js";const L=10;function ze(c){return[{label:"Site-level dN/dS estimates",available:a=>!!a["confidence interval"]},{label:"alpha/beta site-level estimates",available:()=>!0},{label:"Bootstrap vs asymptotic p-value",available:()=>c},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>c},{label:"Dense rate plot",available:()=>!0}]}function Ye(c,a){return{"Site-level dN/dS estimates":"Maximum likelihood estimates of dN/dS at each site, together with estimated profile confidence intervals (if available). dN/dS = 1 (neutrality) is depicted as a horizontal gray line. Boundaries between partitions (if present) are shown as vertical dashed lines.","alpha/beta site-level estimates":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site shown as bars. The line shows the estimates under the null model (α=β). Estimates above ${L} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site. Estimates above ${L} are censored at this value. p-values are also shown`,"Bootstrap vs asymptotic p-value":`Comparison of site-level p-values for non-neutrality using parametric bootstrap and the asymptotic approximation. Rejection region (p ≤ ${a}) is shown as a shaded rectangle`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${L} are censored at this value.`,"Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[c]||""}function qe(c){var m;const a=c.map(e=>({...e,"dN/dS MLE":Math.min(e["dN/dS MLE"]||0,L),"dN/dS LB":Math.min(e["dN/dS LB"]||0,L),"dN/dS UB":Math.min(e["dN/dS UB"]||0,L)}));return Dt({width:800,height:400,marginBottom:40,x:{label:"Codon",tickFormat:e=>e.toString()},y:{label:"dN/dS",grid:!0,type:"sqrt"},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V),legend:!0},marks:[ie([1],{stroke:"gray",strokeOpacity:.5,strokeWidth:2}),...((m=c[0])==null?void 0:m["dN/dS LB"])!==void 0?[re(a,{x:"codon",y1:"dN/dS LB",y2:"dN/dS UB",stroke:"steelblue",strokeWidth:1})]:[],ne(a,{x:"codon",y:"dN/dS MLE",fill:"class",r:4,tip:!0})]})}function Qe(c){const a=c.map(e=>({codon:e.codon,alpha:-Math.min(e.alpha,L),beta:Math.min(e.beta,L),neutral:Math.min(e["alpha=beta"],L),class:e.class,partition:e.partition})),m=Math.max(...a.map(e=>Math.max(Math.abs(e.alpha),e.beta)));return Dt({width:800,height:400,marginLeft:60,marginBottom:50,x:{label:"Codon",tickFormat:e=>e.toString()},y:{label:"Rate estimate",domain:[-m*1.1,m*1.1],grid:!0,tickFormat:e=>{const f=Math.abs(e);return e>0?`β = ${f.toFixed(1)}`:e<0?`α = ${f.toFixed(1)}`:"0"}},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V)},marks:[ie([0],{stroke:"gray",strokeOpacity:.5,strokeWidth:1}),Mt(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:0,y2:"alpha",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),Mt(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:0,y2:"beta",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),re(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:"neutral",y2:"neutral",stroke:"#333",strokeWidth:2,strokeOpacity:.8}),Mt(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:"alpha",y2:"beta",fill:"transparent",title:e=>`Codon ${e.codon}
α = ${Math.abs(e.alpha).toFixed(3)}
β = ${e.beta.toFixed(3)}
α=β = ${e.neutral.toFixed(3)}
Class: ${e.class}`})]})}function Ue(c,a){const m=c.map(e=>({...e,agree:(e["p-value"]-a)*((e["p-asmp"]||0)-a)>=0?"Yes":"No"}));return Dt({width:500,height:500,x:{label:"Bootstrap p-value",type:"sqrt",grid:!0},y:{label:"Asymptotic p-value",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V),legend:!0},marks:[Mt([{x1:0,y1:0,x2:a,y2:a}],{x1:"x1",y1:"y1",x2:"x2",y2:"y2",fill:"#DDD",fillOpacity:.3}),ne(m,{x:"p-value",y:"p-asmp",fill:"class",symbol:e=>e.agree==="Yes"?"circle":"cross",r:5,fillOpacity:.7,tip:!0})]})}function He(c){const a=c.map(u=>Math.min(u.alpha,L)),m=c.map(u=>Math.min(u.beta,L)),e=te(a),f=te(m);return Dt({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},marks:[ee(a,St({y:"count"},{x:u=>u})),ae(a,St({y:"count"},{x:u=>u})),ee(m,St({y:"count"},{x:u=>u})),ae(m,St({y:"count"},{x:u=>u})),le([e],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),le([f],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),oe([{x:e,y:0,text:`α mean: ${e.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-10,fill:"steelblue",fontSize:12}),oe([{x:f,y:0,text:`β mean: ${f.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-25,fill:"orange",fontSize:12})]})}function Ke(c,a,m){switch(c){case"Site-level dN/dS estimates":return qe(a);case"alpha/beta site-level estimates":return Qe(a);case"Bootstrap vs asymptotic p-value":return Ue(a,m);case"Rate density plots":return He(a);default:return null}}var Xe=p('<div class="loading svelte-12t8exx">Loading FEL data...</div>'),Ge=p('<div class="tile svelte-12t8exx"><div class="tile-number svelte-12t8exx"> </div> <div class="tile-description svelte-12t8exx"> </div></div>'),Ie=p('<div class="summary-tiles svelte-12t8exx"></div>'),Je=p("<option> </option>"),Ze=p('<label class="checkbox-label svelte-12t8exx"><input type="checkbox"/> </label>'),ta=p('<th><span class="header-content svelte-12t8exx"> <span class="sort-indicator svelte-12t8exx"><!></span></span></th>'),ea=p('<td class="svelte-12t8exx"><!></td>'),aa=p('<tr class="svelte-12t8exx"></tr>'),sa=p("<button></button>"),la=p('<span class="ellipsis svelte-12t8exx">...</span>'),oa=p("<button> </button>"),ra=p('<span class="ellipsis svelte-12t8exx">...</span>'),ia=p("<button>1</button> <!> <!> <!> <button> </button>",1),na=p('<div class="pagination svelte-12t8exx"><div class="pagination-info svelte-12t8exx"> </div> <div class="pagination-controls svelte-12t8exx"><button class="page-btn svelte-12t8exx">Previous</button> <!> <button class="page-btn svelte-12t8exx">Next</button></div></div>'),va=p('<div class="table-container svelte-12t8exx"><table class="svelte-12t8exx"><thead class="svelte-12t8exx"><tr></tr></thead><tbody class="svelte-12t8exx"></tbody></table> <!></div>'),ca=p('<p class="no-data svelte-12t8exx">No sites match the current filter criteria.</p>'),da=p(`<!> <div class="controls-section svelte-12t8exx"><div class="control-group svelte-12t8exx"><label for="pvalue-threshold" class="svelte-12t8exx">p-value threshold:</label> <input id="pvalue-threshold" type="number" min="0" max="1" step="0.01" class="svelte-12t8exx"/></div> <div class="control-group svelte-12t8exx"><label for="plot-select" class="svelte-12t8exx">Plot type:</label> <select id="plot-select" class="svelte-12t8exx"></select></div> <div class="control-group svelte-12t8exx"><label class="svelte-12t8exx">Show classes:</label> <div class="checkbox-group svelte-12t8exx"></div></div></div> <div class="plot-section svelte-12t8exx"><h3 class="svelte-12t8exx">Figure 1</h3> <p class="plot-description svelte-12t8exx"> </p> <div class="plot-container svelte-12t8exx"></div></div> <div class="table-section svelte-12t8exx"><h3>Table 1</h3> <p class="table-description">Detailed site-by-site results from the FEL analysis</p> <!></div> <div class="citation svelte-12t8exx"><h3>Citation</h3> <code class="svelte-12t8exx">Kosakovsky Pond SL, Frost SDW. Not so different after all: a comparison of methods for detecting amino acid sites under selection. 
        Mol Biol Evol. 2005;22(5):1208-22. doi:10.1093/molbev/msi105</code></div>`,1),pa=p('<div class="fel-visualization svelte-12t8exx"><!></div>');function Pa(c,a){Ce(a,!1);const m=[];let e=kt(a,"data",8,null),f=kt(a,"pvalueThreshold",12,.1),u=kt(a,"showColumns",28,()=>["Diversifying","Purifying","Neutral","Invariable"]),E=kt(a,"plotType",12,"alpha/beta site-level estimates"),Et={},B=g([[],[],{}]),mt=g([]),Tt=g(""),I=g([]),w=g(),nt=g(!1),r=g(1),vt=50,J=g("Site"),Z=g("asc"),jt=[],z=g([]),H=g([]),Rt=g([]),y=g(0);function ve(l){return V[l]||"#000000"}function tt(){jt=t(B)[0]||[],x(z,jt.filter(l=>u().includes(l.class))),x(H,[...t(z)].sort((l,k)=>{const C=l[t(J)],et=k[t(J)];if(typeof C=="number"&&typeof et=="number")return t(Z)==="asc"?C-et:et-C;const at=String(C).toLowerCase(),st=String(et).toLowerCase();return t(Z)==="asc"?at.localeCompare(st):st.localeCompare(at)})),x(y,Math.ceil(t(H).length/vt)),x(Rt,t(H).slice((t(r)-1)*vt,t(r)*vt))}async function At(){var k;if(!((k=e())!=null&&k.MLE))return;Et=Oe(e()),x(B,$e(e(),f())),x(mt,Ee(e(),f()));const l=ze(Et.hasPasmt);x(I,l.filter(C=>C.available(e())).map(C=>C.label)),!t(I).includes(E())&&t(I).length>0&&E(t(I)[0]),tt(),x(nt,!0),await Ut(),t(w)&&wt()}function wt(){if(!(!e()||!E()||t(z).length===0||!t(w))){x(Tt,Ye(E(),f())),Ht(w,t(w).innerHTML="");try{const l=Ke(E(),t(z),f());l&&t(w).appendChild(l)}catch(l){console.error("Error creating plot:",l),Ht(w,t(w).innerHTML='<p class="error">Error rendering plot</p>')}}}function bt(l){x(r,Math.max(1,Math.min(l,t(y)))),tt()}function ce(){t(r)<t(y)&&(It(r),tt())}function de(){t(r)>1&&(It(r,-1),tt())}function pe(l){t(J)===l?x(Z,t(Z)==="asc"?"desc":"asc"):(x(J,l),x(Z,"asc")),x(r,1),tt()}we(async()=>{await Ut(),e()&&(x(nt,!1),await At())});function ue(l,k){return k?k(l):String(l)}$t(()=>(ut(e()),ut(f())),()=>{e()&&f()!==void 0&&(x(nt,!1),At())}),$t(()=>(ut(u()),t(B)),()=>{var l;u()&&((l=t(B)[0])==null?void 0:l.length)>0&&(tt(),wt())}),$t(()=>(ut(E()),t(z),t(w)),()=>{E()&&t(z).length>0&&t(w)&&wt()}),Fe(),Ve();var Ct=pa(),xe=o(Ct);{var me=l=>{var k=Xe();n(l,k)},be=l=>{var k=da(),C=gt(k);{var et=b=>{var v=Ie();U(v,5,()=>t(mt),G,(h,d)=>{var S=Ge(),T=o(S),ct=o(T,!0);s(T);var ht=i(T,2),F=o(ht,!0);s(ht),s(S),P(()=>{se(T,`color: ${t(d),_(()=>t(d).color||"#333")??""}`),$(ct,(t(d),_(()=>t(d).value))),$(F,(t(d),_(()=>t(d).description)))}),n(h,S)}),s(v),n(b,v)};W(C,b=>{t(nt),t(mt),_(()=>t(nt)&&t(mt).length>0)&&b(et)})}var at=i(C,2),st=o(at),Wt=i(o(st),2);Zt(Wt),s(st);var Ft=i(st,2),Pt=i(o(Ft),2);P(()=>{E(),Le(()=>{t(I)})}),U(Pt,5,()=>t(I),G,(b,v)=>{var h=Je(),d=o(h,!0);s(h);var S={};P(()=>{$(d,t(v)),S!==(S=t(v))&&(h.value=(h.__value=t(v))??"")}),n(b,h)}),s(Pt),s(Ft);var Vt=i(Ft,2),zt=i(o(Vt),2);U(zt,5,()=>(ut(V),_(()=>Object.keys(V))),G,(b,v)=>{var h=Ze(),d=o(h);Zt(d);var S,T=i(d);s(h),P(ct=>{se(h,`border-bottom: 2px solid ${ct??""}`),S!==(S=t(v))&&(d.value=(d.__value=t(v))??""),$(T,` ${t(v)??""}`)},[()=>(t(v),_(()=>ve(t(v))))]),Te(m,[],d,()=>(t(v),u()),u),n(b,h)}),s(zt),s(Vt),s(at);var Lt=i(at,2),Bt=i(o(Lt),2),he=o(Bt,!0);s(Bt);var fe=i(Bt,2);Ne(fe,b=>x(w,b),()=>t(w)),s(Lt);var Yt=i(Lt,2),_e=i(o(Yt),4);{var ye=b=>{var v=va(),h=o(v),d=o(h),S=o(d);U(S,5,()=>(t(B),_(()=>t(B)[1])),G,(F,Y)=>{var N=Kt(()=>Gt(t(Y),2));let q=()=>t(N)[0],lt=()=>t(N)[1];var M=ta(),j=o(M),Q=o(j),ot=i(Q),ft=o(ot);{var O=D=>{var R=Xt();P(()=>$(R,t(Z)==="asc"?"↑":"↓")),n(D,R)},K=D=>{var R=Xt("↕");n(D,R)};W(ft,D=>{t(J)===q()?D(O):D(K,!1)})}s(ot),s(j),s(M),P(()=>{Ae(M,"title",lt()),xt(M,1,`sortable ${t(J)===q()?"sorted":""}`,"svelte-12t8exx"),$(Q,`${q()??""} `)}),X("click",M,()=>pe(q())),n(F,M)}),s(S),s(d);var T=i(d);U(T,5,()=>t(Rt),F=>F.codon,(F,Y)=>{var N=aa();U(N,5,()=>(t(B),_(()=>t(B)[1])),G,(q,lt)=>{var M=Kt(()=>Gt(t(lt),1));let j=()=>t(M)[0];var Q=ea(),ot=o(Q);We(ot,()=>(t(Y),j(),t(B),_(()=>ue(t(Y)[j()],t(B)[2][j()])))),s(Q),n(q,Q)}),s(N),n(F,N)}),s(T),s(h);var ct=i(h,2);{var ht=F=>{var Y=na(),N=o(Y),q=o(N);s(N);var lt=i(N,2),M=o(lt),j=i(M,2);{var Q=O=>{var K=Jt(),D=gt(K);U(D,1,()=>(t(y),_(()=>Array(t(y)).fill(0))),G,(R,qt,rt,Nt)=>{var it=sa();it.textContent=rt+1,P(()=>xt(it,1,`page-btn ${t(r)===rt+1?"active":""}`,"svelte-12t8exx")),X("click",it,()=>bt(rt+1)),n(R,it)}),n(O,K)},ot=O=>{var K=ia(),D=gt(K),R=i(D,2);{var qt=A=>{var yt=la();n(A,yt)};W(R,A=>{t(r)>3&&A(qt)})}var rt=i(R,2);U(rt,0,()=>_(()=>Array(3).fill(0)),G,(A,yt,dt,ua)=>{var Qt=Jt(),Se=gt(Qt);{var Me=Ot=>{var pt=oa(),De=o(pt,!0);s(pt),P(()=>{xt(pt,1,`page-btn ${t(r)===t(r)+dt-1?"active":""}`,"svelte-12t8exx"),$(De,t(r)+dt-1)}),X("click",pt,()=>bt(t(r)+dt-1)),n(Ot,pt)};W(Se,Ot=>{t(r)+dt-1>1&&t(r)+dt-1<t(y)&&Ot(Me)})}n(A,Qt)});var Nt=i(rt,2);{var it=A=>{var yt=ra();n(A,yt)};W(Nt,A=>{t(r)<t(y)-2&&A(it)})}var _t=i(Nt,2),ke=o(_t,!0);s(_t),P(()=>{xt(D,1,`page-btn ${t(r)===1?"active":""}`,"svelte-12t8exx"),xt(_t,1,`page-btn ${t(r)===t(y)?"active":""}`,"svelte-12t8exx"),$(ke,t(y))}),X("click",D,()=>bt(1)),X("click",_t,()=>bt(t(y))),n(O,K)};W(j,O=>{t(y)<=7?O(Q):O(ot,!1)})}var ft=i(j,2);s(lt),s(Y),P(O=>{$(q,`Showing ${(t(r)-1)*vt+1}-${O??""} of ${t(H),_(()=>t(H).length)??""} results`),M.disabled=t(r)===1,ft.disabled=t(r)===t(y)},[()=>(t(r),t(H),_(()=>Math.min(t(r)*vt,t(H).length)))]),X("click",M,de),X("click",ft,ce),n(F,Y)};W(ct,F=>{t(y)>1&&F(ht)})}s(v),n(b,v)},ge=b=>{var v=ca();n(b,v)};W(_e,b=>{t(z),_(()=>t(z).length>0)?b(ye):b(ge,!1)})}s(Yt),Be(2),P(()=>$(he,t(Tt))),je(Wt,f),Re(Pt,E),n(l,k)};W(xe,l=>{e()?l(be,!1):l(me)})}s(Ct),n(c,Ct),Pe()}export{Pa as F};
