import"./CWj6FrbW.js";import"./DwqWfmFf.js";import{o as Ze}from"./Cwh0FcVT.js";import{p as Je,y as ke,z as ce,j as Q,i,q as j,A as et,f as S,c as m,r as d,a as k,m as tt,o as A,B as Se,x as at,e as P,s as _,t as W,v as st,n as rt,C as Ce,E as Pe}from"./BAjxKRmT.js";import{s as F}from"./BzaWH1un.js";import{i as de,b as it}from"./CNWIBFBx.js";import{o as ot,p as ze,q as Le,t as ve,u as Te,v as nt,w as Be,x as Ie,y as K,z as $,r as Ee,e as q,i as V,j as lt,a as ct,b as dt,s as ut}from"./DJlT08gO.js";import{m as ue,a as pt,l as vt,h as ht}from"./mVHckqdF.js";import{s as Oe}from"./BVzcOKxO.js";import{i as ft}from"./HQjPdDHY.js";import{p as Y}from"./Dj7YHM2X.js";import{i as mt,aa as Re,b as bt,ab as yt,M as gt,F as _t,e as xt,f as Mt,g as kt,k as St,a9 as Ct,z as G,D as je,A as pe,B as Pt}from"./DMkSVGaj.js";import{d as he}from"./DHrXX71C.js";import{b as zt}from"./PzlVfG0z.js";import{b as Et}from"./K_UNyUlX.js";var Ot=/\s/;function Rt(e){for(var a=e.length;a--&&Ot.test(e.charAt(a)););return a}var wt=/^\s+/;function Dt(e){return e&&e.slice(0,Rt(e)+1).replace(wt,"")}var we=NaN,Lt=/^[-+]0x[0-9a-f]+$/i,Tt=/^0b[01]+$/i,Bt=/^0o[0-7]+$/i,It=parseInt;function jt(e){if(typeof e=="number")return e;if(ot(e))return we;if(ze(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=ze(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=Dt(e);var t=Tt.test(e);return t||Bt.test(e)?It(e.slice(2),t?2:8):Lt.test(e)?we:+e}var De=1/0,At=17976931348623157e292;function Ft(e){if(!e)return e===0?e:0;if(e=jt(e),e===De||e===-De){var a=e<0?-1:1;return a*At}return e===e?e:0}function Nt(e){var a=Ft(e),t=a%1;return a===a?t?a-t:a:0}function Wt(e,a,t,s){for(var r=e.length,o=t+-1;++o<r;)if(a(e[o],o,e))return o;return-1}function qt(e){return function(a,t,s){var r=Object(a);if(!Le(a)){var o=ve(t);a=Te(a),t=function(c){return o(r[c],c,r)}}var n=e(a,t,s);return n>-1?r[o?a[n]:n]:void 0}}var Vt=Math.max;function $t(e,a,t){var s=e==null?0:e.length;if(!s)return-1;var r=t==null?0:Nt(t);return r<0&&(r=Vt(s+r,0)),Wt(e,ve(a),r)}var Xt=qt($t);function Ht(e,a){var t=-1,s=Le(e)?Array(e.length):[];return nt(e,function(r,o,n){s[++t]=a(r,o,n)}),s}function Qt(e,a){var t=Ie(e)?Be:Ht;return t(e,ve(a))}function Gt(e,a){return Be(a,function(t){return e[t]})}function Kt(e){return e==null?[]:Gt(e,Te(e))}var Yt=Math.floor,Ut=Math.random;function Zt(e,a){return e+Yt(Ut()*(a-e+1))}function Ae(e){var a=e.length;return a?e[Zt(0,a-1)]:void 0}function Jt(e){return Ae(Kt(e))}function ea(e){var a=Ie(e)?Ae:Jt;return a(e)}const ta={ariaLabel:"tick",fill:null,stroke:"currentColor"};class aa extends gt{constructor(a,t,s){super(a,t,s,ta),_t(this,s)}render(a,t,s,r,o){return xt("svg:g",o).call(Mt,this,r,o).call(this._transform,this,t).call(n=>n.selectAll().data(a).enter().append("line").call(kt,this).attr("x1",this._x1(t,s,r)).attr("x2",this._x2(t,s,r)).attr("y1",this._y1(t,s,r)).attr("y2",this._y2(t,s,r)).call(St,this,s).call(Ct,this,s,o)).node()}}class sa extends aa{constructor(a,t={}){const{x:s,y:r,inset:o=0,insetTop:n=o,insetBottom:c=o}=t;super(a,{x:{value:s,scale:"x"},y:{value:r,scale:"y",type:"band",optional:!0}},t),this.insetTop=Re(n),this.insetBottom=Re(c)}_transform(a,t,{x:s}){a.call(bt,t,{x:s},yt,0)}_x1(a,{x:t}){return s=>t[s]}_x2(a,{x:t}){return s=>t[s]}_y1({y:a},{y:t},{marginTop:s}){const{insetTop:r}=this;return t&&a?o=>t[o]+r:s+r}_y2({y:a},{y:t},{height:s,marginBottom:r}){const{insetBottom:o}=this;return t&&a?n=>t[n]+a.bandwidth()-o:s-r-o}}function ra(e,{x:a=mt,...t}={}){return new sa(e,{...t,x:a})}const E={Diversifying:"#e3243b",Neutral:"#444",Invariable:"#CCC"};function fe(e){var u;const a=K(e,["MLE","LRT"])&&((u=ea(K(e,["MLE","LRT"])[0]))==null?void 0:u.length)||0,t=!!K(e,["substitutions"]),s=!!Xt(K(e,["MLE","headers"]),h=>h[0]==="Variation p"),r=!1,o=Object.values(e["data partitions"]).map((h,R)=>Object.values(h.coverage[0]).map(w=>[+R+1,w+1])).flat(),n=e.input["number of sequences"],c=e.input["number of sites"],l=e.input["partition count"],v=5,O=Object.values(e["data partitions"]).map(h=>h.coverage[0].length);return{testedBranchCount:v,hasResamples:a,hasSubstitutions:t,hasSiteLRT:s,hasBackground:r,siteIndexPartitionCodon:o,numberOfSequences:n,numberOfSites:c,numberOfPartitions:l,partitionSizes:O}}function me(e,a){return Object.values(e.MLE.content).map(s=>s.filter(r=>r[6]<=+a).length).reduce((s,r)=>s+r,0)}function ia(e,a){const t=me(e,a);return t?(Object.values(e.MLE.content).map(r=>r.filter(o=>o[6]<=+a)).map(r=>r.reduce((o,n)=>o+n[7],0)).reduce((r,o)=>r+o,0)/t).toFixed(2):"N/A"}function oa(e,a){const t=fe(e),s=me(e,a),r=ia(e,a),o=t.hasSiteLRT?Object.values(e.MLE.content).map(n=>n.filter(c=>c[11]<=+a).length).reduce((n,c)=>n+c,0):0;return[{number:e.input["number of sequences"],color:"asbestos",description:"sequences in the alignment",icon:"icon-options-vertical icons"},{number:e.input["number of sites"],color:"asbestos",description:"codon sites in the alignment",icon:"icon-options icons"},{number:e.input["partition count"],color:"asbestos",description:"partitions",icon:"icon-arrow-up icons"},{number:t.testedBranchCount,color:"asbestos",description:"median branches/partition used for testing",icon:"icon-share icons"},{number:t.hasResamples||"N/A",color:"asbestos",description:"parametric bootstrap replicates",icon:"icon-layers icons"},{number:s,color:"midnight_blue",description:"sites subject to episodic diversifying selection",icon:"icon-plus icons"},{number:r,color:"midnight_blue",description:"median branches with support for selection/selected site",icon:"icon-share icons"},{number:o,color:"midnight_blue",description:"sites with variable ω across branches",icon:"icon-energy icons"}]}function na(e,a){const t=fe(e),s=[];let r=0;const o=Qt(e.MLE.headers,c=>(c[2]=c[0],c));return $(e["data partitions"],(c,l)=>{const v=e.MLE.content[l];$(c.coverage[0],(O,u)=>{const h={Partition:t.siteIndexPartitionCodon[r][0],Codon:t.siteIndexPartitionCodon[r][1],alpha:v[u][0],"beta-":v[u][1],"p-":v[u][2],"beta+":v[u][3],"p+":v[u][4],"p-value":v[u][6],Branches:v[u][7],class:"Neutral"};$(o,(w,X)=>{X<8&&(h[w[2]]=v[u][X])});let R="Neutral";v[u][0]===0&&v[u][1]===0&&v[u][3]===0?R="Invariable":v[u][6]<=+a&&(R="Diversifying"),h.class=R,s.push(h),r++})}),[s,{Partition:"Part.",Codon:"Codon",class:"Class",alpha:"α","beta-":"β-","p-":"p-","beta+":"β+","p+":"p+","p-value":"p-value",Branches:"Branches"},o]}function la(e,a=1){const t=[];let s=0;return $(e["branch attributes"],(r,o)=>{let n=0;$(r,(c,l)=>{c["Posterior prob omega class by site"]&&($(c["Posterior prob omega class by site"][a],(v,O)=>{const u=e.MLE.content[o][O][4];t.push({Branch:l,Codon:O+s+1,Posterior:v,ER:ca(u,v)})}),n=c["Posterior prob omega class by site"][a].length)}),s+=n}),t}function ca(e,a){let t=e<1?e/(1-e):1/0,s=a<1?a/(1-a):1/0;return s>0?s/t:t===0?1:1/0}const x=1e4;function da(e,a,t){return[{label:"p-values for selection",available:()=>!0},{label:"p-values for variability",available:()=>e},{label:"Site rates",available:()=>!0},{label:"Support for positive selection",available:()=>t.length>0},{label:"Dense rate plot",available:()=>!0},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>a>0}]}function ua(e,a){return{"p-values for selection":`P-values derived from the ${a?"parametric bootstrap":"asymptotic mixture χ²"} test statistic for likelihood ratio tests for episodic diversifying selection. Solid line = user selected significance threshold.`,"p-values for variability":"P-values derived from the asymptotic mixture χ²₂ test statistic for likelihood ratio tests for variable ω at this site. Solid line = user selected significance threshold.","Site rates":`Site-level rate maximum likelihood estimates (MLE). For each site, the horizontal tick depicts the synonymous rate (α) MLE. Circles show non-synonymous (β- and β+) MLEs, and the size of a circle reflects the weight parameter inferred for the corresponding rate. The non-synonymous rate estimates are connected by a vertical line to enhance readability and show the range of inferred non-synonymous rates and their relationship to the synonymous rate. Estimates above ${x} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α), non-synonymous rates (β-, β+), and non-synonymous weights (p-,p+) at each site. Estimates above ${x} are censored at this value. p-values for episodic diversifying selection are also shown`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${x} are censored at this value.`,"Support for positive selection":"Empirical Bayes Factors for ω>1 at a particular branch and site (only tested branches are included).","Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[e]||""}function pa(e,a){return G({width:800,height:300,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"p-value",type:"log",grid:!0},color:{type:"categorical",domain:Object.keys(E),range:Object.values(E),legend:!0},marks:[je([a],{stroke:"black",strokeWidth:2,strokeDasharray:"4,2"}),he(e,{x:"Codon",y:"p-value",fill:"class",r:3,tip:!0})]})}function va(e){const a=e.flatMap(t=>{const s=Math.min(t.alpha,x),r=Math.min(t["beta-"],x),o=Math.min(t["beta+"],x);return[{codon:t.Codon,rate:s,type:"alpha",weight:1,class:t.class},{codon:t.Codon,rate:r,type:"beta-",weight:t["p-"],class:t.class},{codon:t.Codon,rate:o,type:"beta+",weight:t["p+"],class:t.class}]});return G({width:800,height:400,marginBottom:40,x:{label:"Codon position",grid:!0},y:{label:"Rate estimate",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(E),range:Object.values(E),legend:!0},marks:[ra(a.filter(t=>t.type==="alpha"),{x:"codon",y:"rate",stroke:"class",strokeWidth:2}),he(a.filter(t=>t.type.startsWith("beta")),{x:"codon",y:"rate",fill:"class",r:t=>Math.sqrt(t.weight)*8,fillOpacity:.7,tip:!0}),vt(e.map(t=>({codon:t.Codon,y1:Math.min(t["beta-"],x),y2:Math.min(t["beta+"],x),class:t.class})),{x:"codon",y1:"y1",y2:"y2",stroke:"class",strokeWidth:1,strokeOpacity:.5})]})}function ha(e){const a=e.flatMap(t=>[{codon:t.Codon,rate:Math.min(t.alpha,x),type:"α",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta-"],x),type:"β-",class:t.class,pvalue:t["p-value"]},{codon:t.Codon,rate:Math.min(t["beta+"],x),type:"β+",class:t.class,pvalue:t["p-value"]}]);return G({width:800,height:500,facet:{data:a,y:"type",marginRight:80},x:{label:"Codon position"},y:{label:"Rate estimate",grid:!0},color:{type:"categorical",domain:Object.keys(E),range:Object.values(E),legend:!0},marks:[Et(a,{x:"codon",y:"rate",fill:"class",fillOpacity:.7,tip:!0})]})}function fa(e){const a=e.map(l=>Math.min(l.alpha,x)),t=e.map(l=>Math.min(l["beta-"],x)),s=e.map(l=>Math.min(l["beta+"],x)),r=ue(a),o=ue(t),n=ue(s),c=[...a.map(l=>({value:l,type:"α"})),...t.map(l=>({value:l,type:"β-"})),...s.map(l=>({value:l,type:"β+"}))];return G({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},color:{domain:["α","β-","β+"],range:["steelblue","orange","red"]},marks:[pt(c,zt({y:"count"},{x:"value",fill:"type",fillOpacity:.3,curve:"basis"})),pe([r],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),pe([o],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),pe([n],{stroke:"red",strokeWidth:2,strokeDasharray:"4,2"}),Pt([{x:r,y:0,text:`α: ${r.toFixed(2)}`,type:"α"},{x:o,y:0,text:`β-: ${o.toFixed(2)}`,type:"β-"},{x:n,y:0,text:`β+: ${n.toFixed(2)}`,type:"β+"}],{x:"x",y:"y",text:"text",fill:l=>l.type==="α"?"steelblue":l.type==="β-"?"orange":"red",dy:-10,fontSize:12})]})}function ma(e){return!e||e.length===0?null:G({width:800,height:400,x:{label:"Codon position",grid:!0},y:{label:"Empirical Bayes Factor",type:"log",grid:!0},marks:[he(e,{x:"Codon",y:"ER",fill:"Branch",r:3,fillOpacity:.7,tip:!0}),je([1],{stroke:"black",strokeDasharray:"2,2"})]})}function ba(e,a,t,s){switch(e){case"p-values for selection":return pa(a,t);case"Site rates":return va(a);case"Dense rate plot":return ha(a);case"Rate density plots":return fa(a);case"Support for positive selection":return ma(s||[]);default:return null}}var ya=S('<div class="loading svelte-zch4d7">Loading MEME data...</div>'),ga=S('<div class="tile svelte-zch4d7"><div class="tile-number svelte-zch4d7"> </div> <div class="tile-description svelte-zch4d7"> </div></div>'),_a=S('<div class="summary-tiles svelte-zch4d7"></div>'),xa=S("<option> </option>"),Ma=S('<label class="checkbox-label svelte-zch4d7"><input type="checkbox"/> </label>'),ka=S('<th class="svelte-zch4d7"> </th>'),Sa=S('<td class="svelte-zch4d7"><!></td>'),Ca=S('<tr class="svelte-zch4d7"></tr>'),Pa=S('<div class="table-container svelte-zch4d7"><table class="svelte-zch4d7"><thead class="svelte-zch4d7"><tr></tr></thead><tbody class="svelte-zch4d7"></tbody></table></div>'),za=S('<p class="no-data svelte-zch4d7">No sites match the current filter criteria.</p>'),Ea=S(`<!> <div class="controls-section svelte-zch4d7"><div class="control-group svelte-zch4d7"><label for="pvalue-threshold" class="svelte-zch4d7">p-value threshold:</label> <input id="pvalue-threshold" type="number" min="0" max="1" step="0.01" class="svelte-zch4d7"/></div> <div class="control-group svelte-zch4d7"><label for="plot-select" class="svelte-zch4d7">Plot type:</label> <select id="plot-select" class="svelte-zch4d7"></select></div> <div class="control-group svelte-zch4d7"><label class="svelte-zch4d7">Show classes:</label> <div class="checkbox-group svelte-zch4d7"></div></div></div> <div class="plot-section svelte-zch4d7"><h3 class="svelte-zch4d7">Figure 1</h3> <p class="plot-description svelte-zch4d7"> </p> <div class="plot-container svelte-zch4d7"></div></div> <div class="table-section svelte-zch4d7"><h3>Table 1</h3> <p class="table-description"> </p> <!></div> <div class="citation svelte-zch4d7"><h3>Citation</h3> <code class="svelte-zch4d7">Murrell B, Wertheim JO, Moola S, Weighill T, Scheffler K, Kosakovsky Pond SL. 
        Detecting individual sites subject to episodic diversifying selection. 
        PLoS Genet. 2012;8(7):e1002764. doi:10.1371/journal.pgen.1002764</code></div>`,1),Oa=S('<div class="meme-visualization svelte-zch4d7"><!></div>');function Xa(e,a){Je(a,!1);const t=[];let s=Y(a,"data",8,null),r=Y(a,"pvalueThreshold",12,.1),o=Y(a,"showColumns",28,()=>["Diversifying","Neutral","Invariable"]),n=Y(a,"plotType",12,"p-values for selection"),c={},l=j([[],[],{}]),v=j([]),O=j(""),u=j([]),h=j(),R=j(0),w=[],X=[],D=j([]);function Fe(p){return E[p]||"#000000"}function be(){X=i(l)[0]||[],A(D,X.filter(p=>o().includes(p.class)))}async function ye(){var C;if(!((C=s())!=null&&C.MLE))return;c=fe(s()),A(l,na(s(),r())),A(v,oa(s(),r())),A(R,me(s(),r()));try{w=la(s())}catch{w=[]}const p=da(c.hasSiteLRT,c.hasResamples,w);A(u,p.filter(T=>T.available(s())).map(T=>T.label)),!i(u).includes(n())&&i(u).length>0&&n(i(u)[0]),be(),await ke(),i(h)&&U()}function U(){if(!(!s()||!n()||i(D).length===0||!i(h))){A(O,ua(n(),c.hasResamples)),Se(h,i(h).innerHTML="");try{const p=ba(n(),i(D),r(),w);p&&i(h).appendChild(p)}catch(p){console.error("Error creating plot:",p),Se(h,i(h).innerHTML='<p class="error">Error rendering plot</p>')}}}Ze(async()=>{await ke(),s()&&(dataProcessed=!1,await ye())});function Ne(p,C){return C?C(p):String(p)}ce(()=>(Q(s()),Q(r())),()=>{s()&&r()!==void 0&&(dataProcessed=!1,ye())}),ce(()=>(Q(o()),i(l)),()=>{var p;o()&&((p=i(l)[0])==null?void 0:p.length)>0&&(be(),U())}),ce(()=>(Q(n()),i(D),i(h)),()=>{n()&&i(D).length>0&&i(h)&&U()}),et(),ft();var Z=Oa(),We=m(Z);{var qe=p=>{var C=ya();k(p,C)},Ve=p=>{var C=Ea(),T=at(C);{var $e=y=>{var f=_a();q(f,5,()=>i(v),V,(g,b)=>{var M=ga(),z=m(M),B=m(z,!0);d(z);var I=_(z,2),L=m(I,!0);d(I),d(M),W(()=>{Oe(z,`color: ${i(b),P(()=>i(b).color||"#333")??""}`),F(B,(i(b),P(()=>i(b).value))),F(L,(i(b),P(()=>i(b).description)))}),k(g,M)}),d(f),k(y,f)};de(T,y=>{i(v),P(()=>dataProcessed&&i(v).length>0)&&y($e)})}var J=_(T,2),ee=m(J),ge=_(m(ee),2);Ee(ge),d(ee);var te=_(ee,2),ae=_(m(te),2);W(()=>{n(),st(()=>{i(u)})}),q(ae,5,()=>i(u),V,(y,f)=>{var g=xa(),b=m(g,!0);d(g);var M={};W(()=>{F(b,i(f)),M!==(M=i(f))&&(g.value=(g.__value=i(f))??"")}),k(y,g)}),d(ae),d(te);var _e=_(te,2),xe=_(m(_e),2);q(xe,5,()=>(Q(E),P(()=>Object.keys(E))),V,(y,f)=>{var g=Ma(),b=m(g);Ee(b);var M,z=_(b);d(g),W(B=>{Oe(g,`border-bottom: 2px solid ${B??""}`),M!==(M=i(f))&&(b.value=(b.__value=i(f))??""),F(z,` ${i(f)??""}`)},[()=>(i(f),P(()=>Fe(i(f))))]),lt(t,[],b,()=>(i(f),o()),o),k(y,g)}),d(xe),d(_e),d(J);var se=_(J,2),re=_(m(se),2),Xe=m(re,!0);d(re);var He=_(re,2);it(He,y=>A(h,y),()=>i(h)),d(se);var Me=_(se,2),ie=_(m(Me),2),Qe=m(ie);d(ie);var Ge=_(ie,2);{var Ke=y=>{var f=Pa(),g=m(f),b=m(g),M=m(b);q(M,5,()=>(i(l),P(()=>i(l)[1])),V,(B,I)=>{var L=Ce(()=>Pe(i(I),2));let oe=()=>i(L)[0],ne=()=>i(L)[1];var N=ka(),H=m(N,!0);d(N),W(()=>{ut(N,"title",ne()),F(H,oe())}),k(B,N)}),d(M),d(b);var z=_(b);q(z,5,()=>i(D),V,(B,I)=>{var L=Ca();q(L,5,()=>(i(l),P(()=>i(l)[1])),V,(oe,ne)=>{var N=Ce(()=>Pe(i(ne),1));let H=()=>i(N)[0];var le=Sa(),Ue=m(le);ht(Ue,()=>(i(I),H(),i(l),P(()=>Ne(i(I)[H()],i(l)[2][H()])))),d(le),k(oe,le)}),d(L),k(B,L)}),d(z),d(g),d(f),k(y,f)},Ye=y=>{var f=za();k(y,f)};de(Ge,y=>{i(D),P(()=>i(D).length>0)?y(Ke):y(Ye,!1)})}d(Me),rt(2),W(()=>{F(Xe,i(O)),F(Qe,`${i(R)??""} sites found to be under positive selection at p ≤ ${r()??""}`)}),ct(ge,r),dt(ae,n),k(p,C)};de(We,p=>{s()?p(Ve,!1):p(qe)})}d(Z),k(e,Z),tt()}export{Xa as M};
