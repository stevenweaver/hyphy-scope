import"./CWj6FrbW.js";import"./DwqWfmFf.js";import{o as De}from"./Cwh0FcVT.js";import{p as we,y as Qt,z as Ot,j as pt,i as t,q as D,A as Ce,f as p,c as o,r as s,a as n,m as Fe,o as f,B as Ut,x as yt,e as _,s as i,t as P,v as Pe,n as Le,C as Ht,D as Kt,E as Xt,F as Gt,w as It}from"./BAjxKRmT.js";import{s as $,e as X}from"./BzaWH1un.js";import{i as W,b as Be}from"./CNWIBFBx.js";import{C as V,d as Ne,f as Oe,h as $e,r as Jt,e as U,i as G,j as Ee,a as Te,b as je,s as Re}from"./DJlT08gO.js";import{m as Zt,a as te,l as oe,h as Ae}from"./mVHckqdF.js";import{l as ee,s as ut}from"./BQtjgPEE.js";import{s as ae}from"./BVzcOKxO.js";import{i as We}from"./HQjPdDHY.js";import{p as gt}from"./Dj7YHM2X.js";import{z as Mt,A as se,B as le,C as St,D as re}from"./DMkSVGaj.js";import{b as kt}from"./PzlVfG0z.js";import{d as ie}from"./DHrXX71C.js";const L=10;function Ve(c){return[{label:"Site-level dN/dS estimates",available:a=>!!a["confidence interval"]},{label:"alpha/beta site-level estimates",available:()=>!0},{label:"Bootstrap vs asymptotic p-value",available:()=>c},{label:"Rate density plots",available:()=>!0},{label:"Q-Q plots",available:()=>c},{label:"Dense rate plot",available:()=>!0}]}function ze(c,a){return{"Site-level dN/dS estimates":"Maximum likelihood estimates of dN/dS at each site, together with estimated profile confidence intervals (if available). dN/dS = 1 (neutrality) is depicted as a horizontal gray line. Boundaries between partitions (if present) are shown as vertical dashed lines.","alpha/beta site-level estimates":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site shown as bars. The line shows the estimates under the null model (α=β). Estimates above ${L} are censored at this value.`,"Dense rate plot":`Maximum likelihood estimates of synonymous (α) and non-synonymous rates (β) at each site. Estimates above ${L} are censored at this value. p-values are also shown`,"Bootstrap vs asymptotic p-value":`Comparison of site-level p-values for non-neutrality using parametric bootstrap and the asymptotic approximation. Rejection region (p ≤ ${a}) is shown as a shaded rectangle`,"Rate density plots":`Kernel density estimates of site-level rate estimates. Means are shown with red rules. Estimates above ${L} are censored at this value.`,"Q-Q plots":"Comparison of asymptotic vs bootstrap LRT distributions (limited to 60 sites)."}[c]||""}function Ye(c){var x;const a=c.map(e=>({...e,"dN/dS MLE":Math.min(e["dN/dS MLE"]||0,L),"dN/dS LB":Math.min(e["dN/dS LB"]||0,L),"dN/dS UB":Math.min(e["dN/dS UB"]||0,L)}));return Mt({width:800,height:400,marginBottom:40,x:{label:"Codon",tickFormat:e=>e.toString()},y:{label:"dN/dS",grid:!0,type:"sqrt"},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V),legend:!0},marks:[re([1],{stroke:"gray",strokeOpacity:.5,strokeWidth:2}),...((x=c[0])==null?void 0:x["dN/dS LB"])!==void 0?[oe(a,{x:"codon",y1:"dN/dS LB",y2:"dN/dS UB",stroke:"steelblue",strokeWidth:1})]:[],ie(a,{x:"codon",y:"dN/dS MLE",fill:"class",r:4,tip:!0})]})}function qe(c){const a=c.map(e=>({codon:e.codon,alpha:-Math.min(e.alpha,L),beta:Math.min(e.beta,L),neutral:Math.min(e["alpha=beta"],L),class:e.class,partition:e.partition})),x=Math.max(...a.map(e=>Math.max(Math.abs(e.alpha),e.beta)));return Mt({width:800,height:400,marginLeft:60,marginBottom:50,x:{label:"Codon",tickFormat:e=>e.toString()},y:{label:"Rate estimate",domain:[-x*1.1,x*1.1],grid:!0,tickFormat:e=>{const h=Math.abs(e);return e>0?`β = ${h.toFixed(1)}`:e<0?`α = ${h.toFixed(1)}`:"0"}},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V)},marks:[re([0],{stroke:"gray",strokeOpacity:.5,strokeWidth:1}),St(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:0,y2:"alpha",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),St(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:0,y2:"beta",fill:"class",stroke:"white",strokeWidth:.5,fillOpacity:.8}),oe(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:"neutral",y2:"neutral",stroke:"#333",strokeWidth:2,strokeOpacity:.8}),St(a,{x:e=>e.codon-.4,x2:e=>e.codon+.4,y:"alpha",y2:"beta",fill:"transparent",title:e=>`Codon ${e.codon}
α = ${Math.abs(e.alpha).toFixed(3)}
β = ${e.beta.toFixed(3)}
α=β = ${e.neutral.toFixed(3)}
Class: ${e.class}`})]})}function Qe(c,a){const x=c.map(e=>({...e,agree:(e["p-value"]-a)*((e["p-asmp"]||0)-a)>=0?"Yes":"No"}));return Mt({width:500,height:500,x:{label:"Bootstrap p-value",type:"sqrt",grid:!0},y:{label:"Asymptotic p-value",type:"sqrt",grid:!0},color:{type:"categorical",domain:Object.keys(V),range:Object.values(V),legend:!0},marks:[St([{x1:0,y1:0,x2:a,y2:a}],{x1:"x1",y1:"y1",x2:"x2",y2:"y2",fill:"#DDD",fillOpacity:.3}),ie(x,{x:"p-value",y:"p-asmp",fill:"class",symbol:e=>e.agree==="Yes"?"circle":"cross",r:5,fillOpacity:.7,tip:!0})]})}function Ue(c){const a=c.map(u=>Math.min(u.alpha,L)),x=c.map(u=>Math.min(u.beta,L)),e=Zt(a),h=Zt(x);return Mt({width:600,height:400,x:{label:"Rate value",grid:!0},y:{label:"Density",grid:!0},marks:[te(a,kt({y:"count"},{x:u=>u})),ee(a,kt({y:"count"},{x:u=>u})),te(x,kt({y:"count"},{x:u=>u})),ee(x,kt({y:"count"},{x:u=>u})),se([e],{stroke:"steelblue",strokeWidth:2,strokeDasharray:"4,2"}),se([h],{stroke:"orange",strokeWidth:2,strokeDasharray:"4,2"}),le([{x:e,y:0,text:`α mean: ${e.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-10,fill:"steelblue",fontSize:12}),le([{x:h,y:0,text:`β mean: ${h.toFixed(2)}`}],{x:"x",y:"y",text:"text",dy:-25,fill:"orange",fontSize:12})]})}function He(c,a,x){switch(c){case"Site-level dN/dS estimates":return Ye(a);case"alpha/beta site-level estimates":return qe(a);case"Bootstrap vs asymptotic p-value":return Qe(a,x);case"Rate density plots":return Ue(a);default:return null}}var Ke=p('<div class="loading svelte-12t8exx">Loading FEL data...</div>'),Xe=p('<div class="tile svelte-12t8exx"><div class="tile-number svelte-12t8exx"> </div> <div class="tile-description svelte-12t8exx"> </div></div>'),Ge=p('<div class="summary-tiles svelte-12t8exx"></div>'),Ie=p("<option> </option>"),Je=p('<label class="checkbox-label svelte-12t8exx"><input type="checkbox"/> </label>'),Ze=p('<th><span class="header-content svelte-12t8exx"> <span class="sort-indicator svelte-12t8exx"><!></span></span></th>'),ta=p('<td class="svelte-12t8exx"><!></td>'),ea=p('<tr class="svelte-12t8exx"></tr>'),aa=p("<button></button>"),sa=p('<span class="ellipsis svelte-12t8exx">...</span>'),la=p("<button> </button>"),oa=p('<span class="ellipsis svelte-12t8exx">...</span>'),ra=p("<button>1</button> <!> <!> <!> <button> </button>",1),ia=p('<div class="pagination svelte-12t8exx"><div class="pagination-info svelte-12t8exx"> </div> <div class="pagination-controls svelte-12t8exx"><button class="page-btn svelte-12t8exx">Previous</button> <!> <button class="page-btn svelte-12t8exx">Next</button></div></div>'),na=p('<div class="table-container svelte-12t8exx"><table class="svelte-12t8exx"><thead class="svelte-12t8exx"><tr></tr></thead><tbody class="svelte-12t8exx"></tbody></table> <!></div>'),va=p('<p class="no-data svelte-12t8exx">No sites match the current filter criteria.</p>'),ca=p(`<!> <div class="controls-section svelte-12t8exx"><div class="control-group svelte-12t8exx"><label for="pvalue-threshold" class="svelte-12t8exx">p-value threshold:</label> <input id="pvalue-threshold" type="number" min="0" max="1" step="0.01" class="svelte-12t8exx"/></div> <div class="control-group svelte-12t8exx"><label for="plot-select" class="svelte-12t8exx">Plot type:</label> <select id="plot-select" class="svelte-12t8exx"></select></div> <div class="control-group svelte-12t8exx"><label class="svelte-12t8exx">Show classes:</label> <div class="checkbox-group svelte-12t8exx"></div></div></div> <div class="plot-section svelte-12t8exx"><h3 class="svelte-12t8exx">Figure 1</h3> <p class="plot-description svelte-12t8exx"> </p> <div class="plot-container svelte-12t8exx"></div></div> <div class="table-section svelte-12t8exx"><h3>Table 1</h3> <p class="table-description">Detailed site-by-site results from the FEL analysis</p> <!></div> <div class="citation svelte-12t8exx"><h3>Citation</h3> <code class="svelte-12t8exx">Kosakovsky Pond SL, Frost SDW. Not so different after all: a comparison of methods for detecting amino acid sites under selection. 
        Mol Biol Evol. 2005;22(5):1208-22. doi:10.1093/molbev/msi105</code></div>`,1),da=p('<div class="fel-visualization svelte-12t8exx"><!></div>');function Fa(c,a){we(a,!1);const x=[];let e=gt(a,"data",8,null),h=gt(a,"pvalueThreshold",12,.1),u=gt(a,"showColumns",28,()=>["Diversifying","Purifying","Neutral","Invariable"]),E=gt(a,"plotType",12,"alpha/beta site-level estimates"),$t={},B=D([[],[],{}]),xt=D([]),Et=D(""),I=D([]),w=D(),r=D(1),nt=50,J=D("Site"),Z=D("asc"),Tt=[],z=D([]),H=D([]),jt=D([]),y=D(0);function ne(l){return V[l]||"#000000"}function tt(){Tt=t(B)[0]||[],f(z,Tt.filter(l=>u().includes(l.class))),f(H,[...t(z)].sort((l,g)=>{const C=l[t(J)],et=g[t(J)];if(typeof C=="number"&&typeof et=="number")return t(Z)==="asc"?C-et:et-C;const at=String(C).toLowerCase(),st=String(et).toLowerCase();return t(Z)==="asc"?at.localeCompare(st):st.localeCompare(at)})),f(y,Math.ceil(t(H).length/nt)),f(jt,t(H).slice((t(r)-1)*nt,t(r)*nt))}async function Rt(){var g;if(!((g=e())!=null&&g.MLE))return;$t=Ne(e()),f(B,Oe(e(),h())),f(xt,$e(e(),h()));const l=Ve($t.hasPasmt);f(I,l.filter(C=>C.available(e())).map(C=>C.label)),!t(I).includes(E())&&t(I).length>0&&E(t(I)[0]),tt(),await Qt(),t(w)&&Dt()}function Dt(){if(!(!e()||!E()||t(z).length===0||!t(w))){f(Et,ze(E(),h())),Ut(w,t(w).innerHTML="");try{const l=He(E(),t(z),h());l&&t(w).appendChild(l)}catch(l){console.error("Error creating plot:",l),Ut(w,t(w).innerHTML='<p class="error">Error rendering plot</p>')}}}function mt(l){f(r,Math.max(1,Math.min(l,t(y)))),tt()}function ve(){t(r)<t(y)&&(Gt(r),tt())}function ce(){t(r)>1&&(Gt(r,-1),tt())}function de(l){t(J)===l?f(Z,t(Z)==="asc"?"desc":"asc"):(f(J,l),f(Z,"asc")),f(r,1),tt()}De(async()=>{await Qt(),e()&&await Rt()});function pe(l,g){return g?g(l):String(l)}Ot(()=>(pt(e()),pt(h())),()=>{e()&&h()!==void 0&&Rt()}),Ot(()=>(pt(u()),t(B)),()=>{var l;u()&&((l=t(B)[0])==null?void 0:l.length)>0&&(tt(),Dt())}),Ot(()=>(pt(E()),t(z),t(w)),()=>{E()&&t(z).length>0&&t(w)&&Dt()}),Ce(),We();var wt=da(),ue=o(wt);{var xe=l=>{var g=Ke();n(l,g)},me=l=>{var g=ca(),C=yt(g);{var et=m=>{var v=Ge();U(v,5,()=>t(xt),G,(b,d)=>{var k=Xe(),T=o(k),vt=o(T,!0);s(T);var bt=i(T,2),F=o(bt,!0);s(bt),s(k),P(()=>{ae(T,`color: ${t(d),_(()=>t(d).color||"#333")??""}`),$(vt,(t(d),_(()=>t(d).value))),$(F,(t(d),_(()=>t(d).description)))}),n(b,k)}),s(v),n(m,v)};W(C,m=>{t(xt),_(()=>t(xt).length>0)&&m(et)})}var at=i(C,2),st=o(at),At=i(o(st),2);Jt(At),s(st);var Ct=i(st,2),Ft=i(o(Ct),2);P(()=>{E(),Pe(()=>{t(I)})}),U(Ft,5,()=>t(I),G,(m,v)=>{var b=Ie(),d=o(b,!0);s(b);var k={};P(()=>{$(d,t(v)),k!==(k=t(v))&&(b.value=(b.__value=t(v))??"")}),n(m,b)}),s(Ft),s(Ct);var Wt=i(Ct,2),Vt=i(o(Wt),2);U(Vt,5,()=>(pt(V),_(()=>Object.keys(V))),G,(m,v)=>{var b=Je(),d=o(b);Jt(d);var k,T=i(d);s(b),P(vt=>{ae(b,`border-bottom: 2px solid ${vt??""}`),k!==(k=t(v))&&(d.value=(d.__value=t(v))??""),$(T,` ${t(v)??""}`)},[()=>(t(v),_(()=>ne(t(v))))]),Ee(x,[],d,()=>(t(v),u()),u),n(m,b)}),s(Vt),s(Wt),s(at);var Pt=i(at,2),Lt=i(o(Pt),2),be=o(Lt,!0);s(Lt);var he=i(Lt,2);Be(he,m=>f(w,m),()=>t(w)),s(Pt);var zt=i(Pt,2),fe=i(o(zt),4);{var _e=m=>{var v=na(),b=o(v),d=o(b),k=o(d);U(k,5,()=>(t(B),_(()=>t(B)[1])),G,(F,Y)=>{var N=Ht(()=>Xt(t(Y),2));let q=()=>t(N)[0],lt=()=>t(N)[1];var S=Ze(),j=o(S),Q=o(j),ot=i(Q),ht=o(ot);{var O=M=>{var R=Kt();P(()=>$(R,t(Z)==="asc"?"↑":"↓")),n(M,R)},K=M=>{var R=Kt("↕");n(M,R)};W(ht,M=>{t(J)===q()?M(O):M(K,!1)})}s(ot),s(j),s(S),P(()=>{Re(S,"title",lt()),ut(S,1,`sortable ${t(J)===q()?"sorted":""}`,"svelte-12t8exx"),$(Q,`${q()??""} `)}),X("click",S,()=>de(q())),n(F,S)}),s(k),s(d);var T=i(d);U(T,5,()=>t(jt),F=>F.codon,(F,Y)=>{var N=ea();U(N,5,()=>(t(B),_(()=>t(B)[1])),G,(q,lt)=>{var S=Ht(()=>Xt(t(lt),1));let j=()=>t(S)[0];var Q=ta(),ot=o(Q);Ae(ot,()=>(t(Y),j(),t(B),_(()=>pe(t(Y)[j()],t(B)[2][j()])))),s(Q),n(q,Q)}),s(N),n(F,N)}),s(T),s(b);var vt=i(b,2);{var bt=F=>{var Y=ia(),N=o(Y),q=o(N);s(N);var lt=i(N,2),S=o(lt),j=i(S,2);{var Q=O=>{var K=It(),M=yt(K);U(M,1,()=>(t(y),_(()=>Array(t(y)).fill(0))),G,(R,Yt,rt,Bt)=>{var it=aa();it.textContent=rt+1,P(()=>ut(it,1,`page-btn ${t(r)===rt+1?"active":""}`,"svelte-12t8exx")),X("click",it,()=>mt(rt+1)),n(R,it)}),n(O,K)},ot=O=>{var K=ra(),M=yt(K),R=i(M,2);{var Yt=A=>{var _t=sa();n(A,_t)};W(R,A=>{t(r)>3&&A(Yt)})}var rt=i(R,2);U(rt,0,()=>_(()=>Array(3).fill(0)),G,(A,_t,ct,pa)=>{var qt=It(),ke=yt(qt);{var Se=Nt=>{var dt=la(),Me=o(dt,!0);s(dt),P(()=>{ut(dt,1,`page-btn ${t(r)===t(r)+ct-1?"active":""}`,"svelte-12t8exx"),$(Me,t(r)+ct-1)}),X("click",dt,()=>mt(t(r)+ct-1)),n(Nt,dt)};W(ke,Nt=>{t(r)+ct-1>1&&t(r)+ct-1<t(y)&&Nt(Se)})}n(A,qt)});var Bt=i(rt,2);{var it=A=>{var _t=oa();n(A,_t)};W(Bt,A=>{t(r)<t(y)-2&&A(it)})}var ft=i(Bt,2),ge=o(ft,!0);s(ft),P(()=>{ut(M,1,`page-btn ${t(r)===1?"active":""}`,"svelte-12t8exx"),ut(ft,1,`page-btn ${t(r)===t(y)?"active":""}`,"svelte-12t8exx"),$(ge,t(y))}),X("click",M,()=>mt(1)),X("click",ft,()=>mt(t(y))),n(O,K)};W(j,O=>{t(y)<=7?O(Q):O(ot,!1)})}var ht=i(j,2);s(lt),s(Y),P(O=>{$(q,`Showing ${(t(r)-1)*nt+1}-${O??""} of ${t(H),_(()=>t(H).length)??""} results`),S.disabled=t(r)===1,ht.disabled=t(r)===t(y)},[()=>(t(r),t(H),_(()=>Math.min(t(r)*nt,t(H).length)))]),X("click",S,ce),X("click",ht,ve),n(F,Y)};W(vt,F=>{t(y)>1&&F(bt)})}s(v),n(m,v)},ye=m=>{var v=va();n(m,v)};W(fe,m=>{t(z),_(()=>t(z).length>0)?m(_e):m(ye,!1)})}s(zt),Le(2),P(()=>$(be,t(Et))),Te(At,h),je(Ft,E),n(l,g)};W(ue,l=>{e()?l(me,!1):l(xe)})}s(wt),n(c,wt),Fe()}export{Fa as F};
